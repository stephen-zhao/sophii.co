{"version":3,"file":"avoidance.js","sources":["../src/avoidance.js"],"sourcesContent":["// avoidance.js\r\n// AUTHOR: Stephen Zhao\r\n// REPO: github.com/stephen-zhao/sophii.co\r\n\r\n// A standalone library for creating \"avoidance cloud\" effect.\r\n// All children of given containers will be animated to avoid the user's mouse.\r\n\r\n// The class which exposes the public API\r\nexport default class Avoidance {\r\n  // input:\r\n  //   containerSelector\r\n  //    - css-selector string which specifies the elements\r\n  //      inside which the avoidance effect is triggered.\r\n  //   options\r\n  //    - an settings object that takes the following *optional* key/values:\r\n  //      factorMethod: {\r\n  //        name: one of \"inverse\", \"powerInverse\", or \"exponential\"\r\n  //        scale: a number\r\n  //        offset: a number\r\n  //        power: a number\r\n  //      },\r\n  //      displacementMethod: {\r\n  //        name: one of \"noThreshold\" or \"threshold\"\r\n  //        thresholdRadius: a number\r\n  //      },\r\n  //      timing: one of\r\n  //        \"linear\", \"easeOutCubic\", \"easeOutExpo\"\r\n  //      pathing: one of\r\n  //        \"linear\", \"bezierQuad\"\r\n  //   addChildrenAsParticles\r\n  //    - boolean which specifies whether or not the children\r\n  //      of the containers are added initially as tracked\r\n  //      particles. Defaults to true.\r\n  constructor(containerSelector, options = {}, addChildrenAsParticles = true) {\r\n    // save the containers\r\n    var containersCollection = document.querySelectorAll(containerSelector);\r\n    this.containers = Array.prototype.slice.call(containersCollection);\r\n    // save options for future use\r\n    this.options = this.initOptions(options);\r\n    // init tracked particles\r\n    this.trackedParticles = [];\r\n    this.trackedParticleElementsSet = new Set();\r\n    // \"fix\" event listeners\r\n    this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\r\n    this.clickHandler = this.clickHandler.bind(this);\r\n    this.touchStartHandler = this.touchStartHandler.bind(this);\r\n    this.touchEndHandler = this.touchEndHandler.bind(this);\r\n    // Create particles from all of the container's children\r\n    // and add them to the list of tracked particles, if specified to do so\r\n    if (addChildrenAsParticles) {\r\n      this.containers.forEach(function (container) {\r\n        for (var i = 0; i < container.children.length; ++i) {\r\n          this.startTrackingParticleElement(container.children[i], container);\r\n        }\r\n      }, this);\r\n    }\r\n    // set the initial status\r\n    this.status = \"ready\";\r\n  }\r\n\r\n  initOptions(userOptions) {\r\n    var options = {};\r\n\r\n    // Process factorMethod option\r\n    options.factorMethod = {};\r\n    if (\"factorMethod\" in userOptions) {\r\n      if (typeof userOptions.factorMethod === \"string\"\r\n          && (userOptions.factorMethod in Avoidance.calculateAvoidanceFactor.builtinMethods)) {\r\n        options.factorMethod.name = userOptions.factorMethod;\r\n        options.factorMethod.scale = undefined;\r\n        options.factorMethod.offset = undefined;\r\n        options.factorMethod.power = undefined;\r\n      }\r\n      else if (typeof userOptions.factorMethod === \"object\") {\r\n        if ((\"name\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.name === \"string\")\r\n            && (userOptions.factorMethod.name in Avoidance.calculateAvoidanceFactor.builtinMethods)) {\r\n          options.factorMethod.name = userOptions.factorMethod.name;\r\n        }\r\n        else {\r\n          options.factorMethod.name = undefined;\r\n        }\r\n        if ((\"scale\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.scale === \"number\")) {\r\n          options.factorMethod.scale = userOptions.factorMethod.scale;\r\n        }\r\n        else {\r\n          options.factorMethod.scale = undefined;\r\n        }\r\n        if ((\"offset\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.offset === \"number\")) {\r\n          options.factorMethod.offset = userOptions.factorMethod.offset;\r\n        }\r\n        else {\r\n          options.factorMethod.offset = undefined;\r\n        }\r\n        if ((\"power\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.power === \"number\")) {\r\n          options.factorMethod.power = userOptions.factorMethod.power;\r\n        }\r\n        else {\r\n          options.factorMethod.power = undefined;\r\n        }\r\n      }\r\n      else {\r\n        options.factorMethod.name = undefined;\r\n        options.factorMethod.scale = undefined;\r\n        options.factorMethod.offset = undefined;\r\n        options.factorMethod.power = undefined;\r\n      }\r\n    }\r\n\r\n    // Process displacementMethod\r\n    options.displacementMethod = {};\r\n    if (\"displacementMethod\" in userOptions) {\r\n      if (typeof userOptions.displacementMethod === \"string\"\r\n          && (userOptions.displacementMethod in Avoidance.calculateAvoidanceDisplacement.builtinMethods)) {\r\n        options.displacementMethod.name = userOptions.displacementMethod;\r\n        options.displacementMethod.thresholdRadius = undefined;\r\n      }\r\n      else if (typeof userOptions.displacementMethod === \"object\") {\r\n        if ((\"name\" in userOptions.displacementMethod)\r\n            && (typeof userOptions.displacementMethod.name === \"string\")\r\n            && (userOptions.displacementMethod.name in Avoidance.calculateAvoidanceDisplacement.builtinMethods)) {\r\n          options.displacementMethod.name = userOptions.displacementMethod.name;\r\n        }\r\n        else {\r\n          options.displacementMethod.name = undefined;\r\n        }\r\n        if ((\"thresholdRadius\" in userOptions.displacementMethod)\r\n            && (typeof userOptions.displacementMethod.thresholdRadius === \"number\")) {\r\n          options.displacementMethod.thresholdRadius = userOptions.displacementMethod.thresholdRadius;\r\n        }\r\n        else {\r\n          options.displacementMethod.thresholdRadius = undefined;\r\n        }\r\n      }\r\n      else {\r\n        options.displacementMethod.name = undefined;\r\n        options.displacementMethod.thresholdRadius = undefined;\r\n      }\r\n    }\r\n\r\n    // Process timings\r\n    if (\"timing\" in userOptions\r\n        && (typeof userOptions.timing === \"string\")\r\n        && (userOptions.timing in Avoidance.animate.timings)) {\r\n      options.timing = Avoidance.animate.timings[userOptions.timing];\r\n    }\r\n    else {\r\n      options.timing = Avoidance.animate.timings.easeOutExpo;\r\n    }\r\n    \r\n    // Process pathing\r\n    if (\"pathing\" in userOptions\r\n        && (typeof userOptions.pathing === \"string\")\r\n        && (userOptions.pathing in Avoidance.animate.paths)) {\r\n      options.pathing = userOptions.pathing;\r\n    }\r\n    else {\r\n      options.pathing = \"bezierQuad\";\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  addParticles(particleSelector, containerSelector) {\r\n    document.querySelectorAll(particleSelector).forEach(particleElement => {\r\n      this.startTrackingParticleElement(particleElement, containerSelector ? document.querySelector(containerSelector) : undefined);\r\n    }, this);\r\n  }\r\n\r\n  addParticleElement(particleElement, containerElement) {\r\n    this.startTrackingParticleElement(particleElement, containerElement);\r\n  }\r\n\r\n  removeParticles(particleSelector) {\r\n    this.stopTrackingParticleElements(document.querySelectorAll(particleSelector));\r\n  }\r\n\r\n  removeParticleElement(particleElement) {\r\n    this.stopTrackingParticleElement(particleElement);\r\n  }\r\n\r\n  startTrackingParticleElement(particleElement, containerElement) {\r\n    if (!this.trackedParticleElementsSet.has(particleElement)) {\r\n      if (!containerElement) {\r\n        containerElement = document.body;\r\n      }\r\n      var particle = new Avoidance.Particle(particleElement, containerElement);\r\n      this.trackedParticles.push(particle);\r\n      this.trackedParticleElementsSet.add(particleElement);\r\n    }\r\n  }\r\n\r\n  stopTrackingParticleElement(particleElement) {\r\n    if (this.trackedParticleElementsSet.has(particleElement)) {\r\n      // First remove from lookup set\r\n      this.trackedParticleElementsSet.delete(particleElement);\r\n      var foundIdx = this.trackedParticles.findIndex(function(particle) {\r\n        return particle.element === particleElement;\r\n      });\r\n      if (foundIdx !== -1) {\r\n        // Then dispose\r\n        this.trackedParticles[foundIdx].dispose();\r\n        // Then remove from tracked particles\r\n        this.trackedParticles.splice(foundIdx, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  stopTrackingParticleElements(particleElements) {\r\n    var particleElementSet = new Set(particleElements);\r\n    for (var i = 0; i < this.trackedParticles.length; ++i) {\r\n      if (particleElementSet.has(this.trackedParticles[i].element)) {\r\n        // First remove from lookup set\r\n        this.trackedParticleElementsSet.delete(this.trackedParticles[i].element);\r\n        // Then dispose\r\n        this.trackedParticles[i].dispose();\r\n        // Then remove from tracked particles\r\n        this.trackedParticles[i] = \"removed\";\r\n      }\r\n    }\r\n    // Realize the removal\r\n    this.trackedParticles = this.trackedParticles.filter(function(particle) {\r\n      return particle !== \"removed\";\r\n    });\r\n  }\r\n\r\n  start() {\r\n    // Add all event handlers to each container\r\n    this.containers.forEach(this.registerEventHandlers, this);\r\n    // Let particles know movement has started\r\n    this.trackedParticles.forEach(particle => {\r\n      particle.unfreeze();\r\n    });\r\n    this.status = \"running\";\r\n  }\r\n\r\n  stop() {\r\n    // Let all particles know to stop\r\n    this.trackedParticles.forEach(particle => {\r\n      particle.freeze();\r\n    });\r\n    // remove all event handlers from each container\r\n    this.containers.forEach(this.deregisterEventHandlers, this);\r\n    this.status = \"stopped\";\r\n  }\r\n\r\n  addContainers(containerSelector, addChildrenAsParticles = true) {\r\n    // Split work by processing each selected container iteratively\r\n    var containersCollection = document.querySelectorAll(containerSelector);\r\n    containersCollection.forEach(function(container) {\r\n      // Only add if not already added\r\n      var idx = this.containers.indexOf(container);\r\n      if (idx >= 0) {\r\n        return;\r\n      }\r\n      this.containers.push(container);\r\n      // Add children as particles if specified to do so\r\n      if (addChildrenAsParticles) {\r\n        for (var i = 0; i < container.children.length; ++i) {\r\n          this.startTrackingParticleElement(container.children[i]);\r\n        }\r\n      }\r\n      // Register handlers if we are already running\r\n      if (this.status === \"running\") {\r\n        this.registerEventHandlers(container);\r\n      }\r\n    }, this);\r\n  }\r\n\r\n  removeContainers(containerSelector, removeChildrenAsParticles = true) {\r\n    // Process each selected container iteratively\r\n    var containersCollection = document.querySelectorAll(containerSelector);\r\n    containersCollection.forEach(function(container) {\r\n      // Process only if the container is tracked\r\n      var idx = this.containers.indexOf(container);\r\n      if (idx < 0) {\r\n        return;\r\n      }\r\n      // Remove children as particles if specified to do so\r\n      if (removeChildrenAsParticles) {\r\n        this.stopTrackingParticleElements(container.children);\r\n      }\r\n      // Deregister events if we are running\r\n      if (this.status === \"running\") {\r\n        this.deregisterEventHandlers(container);\r\n      }\r\n      // Remove from tracked containers\r\n      this.containers.splice(idx, 1);\r\n    }, this);\r\n  }\r\n\r\n  registerEventHandlers(container) {\r\n    container.addEventListener(\"touchend\", this.touchEndHandler);\r\n    container.addEventListener(\"touchstart\", this.touchStartHandler);\r\n    container.addEventListener(\"mousemove\", this.mouseMoveHandler);\r\n    container.addEventListener(\"click\", this.clickHandler);\r\n  }\r\n\r\n  deregisterEventHandlers(container) {\r\n    container.removeEventListener(\"click\", this.clickHandler);\r\n    container.removeEventListener(\"mousemove\", this.mouseMoveHandler);\r\n    container.removeEventListener(\"touchstart\", this.touchStartHandler);\r\n    container.removeEventListener(\"touchend\", this.touchEndHandler);\r\n  }\r\n\r\n  mouseMoveHandler(event) {\r\n    if (this.touchStarted || this.touchEnded) {\r\n      // Do not handle a mouseMove for touch events\r\n      event.preventDefault();\r\n    }\r\n    else {\r\n      const container = event.currentTarget;\r\n      const mousePos = { x: event.pageX - container.offsetLeft, y: event.pageY - container.offsetTop };\r\n      this.computeAvoidance(container, mousePos, this.renderImmediateAvoidance.bind(this));\r\n    }\r\n  }\r\n\r\n  clickHandler(event) {\r\n    if (this.touchStarted || this.touchEnded) {\r\n      const container = event.currentTarget;\r\n      const touchPos = { x: event.pageX - container.offsetLeft, y: event.pageY - container.offsetTop };\r\n      this.computeAvoidance(container, touchPos, this.renderAnimatedAvoidance.bind(this));\r\n      this.touchStarted = false;\r\n      this.touchEnded = false;\r\n    }\r\n    else {\r\n      // click, but not touched\r\n    }\r\n  }\r\n\r\n  touchStartHandler(event) {\r\n    this.touchStarted = true;\r\n  }\r\n\r\n  touchEndHandler(event) {\r\n    this.touchEnded = true;\r\n  }\r\n\r\n  computeAvoidance(container, userPos, renderCallback) {\r\n    const containerRect = container.getBoundingClientRect();\r\n    const userPosRatio = {\r\n      x: userPos.x / containerRect.width,\r\n      y: userPos.y / containerRect.height,\r\n    };\r\n    this.trackedParticles.forEach(function (particle) {\r\n      const particleSizeRatio = particle.getSizeRatio();\r\n      const particleCentreOrigPosRatioRelUser = {\r\n        x: particle.originalPosRatio.x + particleSizeRatio.width*1.0 / 2 - userPosRatio.x,\r\n        y: particle.originalPosRatio.y + particleSizeRatio.height*1.0 / 2 - userPosRatio.y,\r\n      };\r\n      const particleCentreOrigDistRelUser = Avoidance.geometry.getRadius(particleCentreOrigPosRatioRelUser);\r\n      const avoidanceFactor = this.calculateAvoidanceFactor(particleCentreOrigDistRelUser, particleSizeRatio);\r\n      const avoidanceDisplacement = this.calculateAvoidanceDisplacement(\r\n        Avoidance.geometry.getUnitVector(particleCentreOrigPosRatioRelUser), avoidanceFactor);\r\n      renderCallback(avoidanceDisplacement, particle);\r\n    }, this);\r\n  }\r\n\r\n  renderImmediateAvoidance(avoidanceDisplacement, particle) {\r\n    if (avoidanceDisplacement === null) {\r\n      particle.element.style.display = \"none\";\r\n    }\r\n    else {\r\n      const particleNewPos = {\r\n        x: particle.originalPosRatio.x + avoidanceDisplacement.x,\r\n        y: particle.originalPosRatio.y + avoidanceDisplacement.y,\r\n      };\r\n      if (particle.element.style.display === \"none\") {\r\n        particle.element.style.display = \"\";\r\n      }\r\n      particle.element.style.left = Avoidance.math.toPctStr(particleNewPos.x);\r\n      particle.element.style.top = Avoidance.math.toPctStr(particleNewPos.y);\r\n    }\r\n  }\r\n\r\n  renderAnimatedAvoidance(avoidanceDisplacement, particle) {\r\n    if (avoidanceDisplacement === null) {\r\n      particle.element.style.display = \"none\";\r\n    }\r\n    else {\r\n      const particleOldPosRatio = particle.getPosRatio();\r\n      const particleNewPosRatio = {\r\n        x: particle.originalPosRatio.x + avoidanceDisplacement.x,\r\n        y: particle.originalPosRatio.y + avoidanceDisplacement.y,\r\n      };\r\n      if (particle.element.style.display === \"none\") {\r\n        particle.element.style.display = \"\";\r\n      }\r\n      const pathing = this.options.pathing === \"bezierQuad\"\r\n        ? Avoidance.animate.paths.bezierQuad(particleOldPosRatio, particle.originalPosRatio, particleNewPosRatio)\r\n        : Avoidance.animate.paths.linear(particleOldPosRatio, particleNewPosRatio);\r\n      Avoidance.animate.move(particle.element, pathing, 1000, this.options.timing);\r\n    }\r\n  }\r\n\r\n  calculateAvoidanceFactor(originalDistance, elementSize, method) {\r\n    if (method === undefined) {\r\n      method = this.options.factorMethod.name;\r\n    }\r\n    var methodFn = null;\r\n    if (method !== undefined) {\r\n      methodFn = Avoidance.calculateAvoidanceFactor.builtinMethods[method];\r\n    }\r\n    else {\r\n      methodFn = Avoidance.calculateAvoidanceFactor.builtinMethods.powerInverse;\r\n    }\r\n    return methodFn(\r\n      this.options.factorMethod.scale,\r\n      this.options.factorMethod.offset,\r\n      this.options.factorMethod.power\r\n    )(originalDistance, elementSize);\r\n  }\r\n  \r\n  calculateAvoidanceDisplacement(particleOrigPosRelMouse, avoidanceFactor, method) {\r\n    if (method === undefined) {\r\n      method = this.options.displacementMethod.name;\r\n    }\r\n    var methodFn = null;\r\n    if (method !== undefined) {\r\n      methodFn = Avoidance.calculateAvoidanceDisplacement.builtinMethods[method];\r\n    }\r\n    else {\r\n      methodFn = Avoidance.calculateAvoidanceDisplacement.builtinMethods.threshold;\r\n    }\r\n    return methodFn(\r\n      this.options.displacementMethod.thresholdRadius\r\n    )(particleOrigPosRelMouse, avoidanceFactor);\r\n  }\r\n}\r\n\r\nAvoidance.geometry = {\r\n  getDistance: function(pointA, pointB) {\r\n    return Math.sqrt(Math.pow(pointA.x - pointB.x, 2) + Math.pow(pointA.y - pointB.y, 2));\r\n  },\r\n  getRadius: function(point) {\r\n    return Math.sqrt(point.x*point.x + point.y*point.y);\r\n  },\r\n  getUnitVector: function(point) {\r\n    const radius = Avoidance.geometry.getRadius(point);\r\n    return {\r\n      x: point.x / radius,\r\n      y: point.y / radius,\r\n    };\r\n  }\r\n}\r\n\r\nAvoidance.calculateAvoidanceFactor = {\r\n  builtinMethods: {\r\n    inverse: function(param_scale=0.02, param_offset=0.0, param_power=undefined) {\r\n      return function(originalDistance, elementSize) {\r\n        if (originalDistance === 0) {\r\n          return NaN;\r\n        }\r\n        else {\r\n          return (param_scale*1.0)/originalDistance + param_offset;\r\n        }\r\n      }\r\n    },\r\n    exponential: function(param_scale=0.1, param_offset=0.0, param_power=undefined) {\r\n      return function(originalDistance, elementSize) {\r\n        return Math.exp(param_scale-originalDistance) + param_offset;\r\n      }\r\n    },\r\n    powerInverse: function(param_scale=0.02, param_offset=0.0, param_power=0.6) {\r\n      return function(originalDistance, elementSize) {\r\n        if (originalDistance === 0) {\r\n          return NaN;\r\n        }\r\n        else {\r\n          return ((param_scale*1.0)/Math.pow(originalDistance*1.0, param_power) + param_offset);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nAvoidance.calculateAvoidanceDisplacement = {\r\n  builtinMethods: {\r\n    threshold: function(param_threshold_radius=0.1) {\r\n      return function(directionUnitVector, avoidanceFactor) {\r\n        if (avoidanceFactor === NaN) {\r\n          return null;\r\n        }\r\n        var offset = {\r\n          x: directionUnitVector.x*avoidanceFactor,\r\n          y: directionUnitVector.y*avoidanceFactor,\r\n        };\r\n        if (Avoidance.geometry.getRadius(offset) > param_threshold_radius) {\r\n          return {\r\n            x: directionUnitVector.x*param_threshold_radius,\r\n            y: directionUnitVector.y*param_threshold_radius,\r\n          };\r\n        }\r\n        else {\r\n          return offset;\r\n        }\r\n      }\r\n    },\r\n    noThreshold: function(param_threshold_radius=undefined) {\r\n      return function(directionUnitVector, avoidanceFactor) {\r\n        if (avoidanceFactor === NaN) {\r\n          return null;\r\n        }\r\n        return {\r\n          x: directionUnitVector.x*avoidanceFactor,\r\n          y: directionUnitVector.y*avoidanceFactor,\r\n        };\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nAvoidance.math = {\r\n  toPctStr: function(x) {\r\n    return (100.0 * x) + \"%\";\r\n  }\r\n}\r\n\r\nAvoidance.animate = {\r\n  FRAME_DURATION: 10.0,\r\n  timings: {\r\n    linear: duration => t => t/duration,\r\n    easeOutCubic: duration => t => 1+Math.pow(t/duration-1, 3),\r\n    easeOutExpo: duration => t => 1-Math.pow(2, -10*t/duration),\r\n  },\r\n  paths: {\r\n    linear: function(p0, p1) {\r\n      return s => ({\r\n        x: p0.x + s*(p1.x - p0.x),\r\n        y: p0.y + s*(p1.y - p0.y),\r\n      });\r\n    },\r\n    bezierQuad: function(p0, p1, p2) {\r\n      return s => ({\r\n        x: p1.x + (1.0-s)*(1.0-s)*(p0.x-p1.x) + s*s*(p2.x-p1.x),\r\n        y: p1.y + (1.0-s)*(1.0-s)*(p0.y-p1.y) + s*s*(p2.y-p1.y),\r\n      }); // 0 <= s <= 1\r\n    },\r\n  },\r\n  move: function(element, pathing, duration, timing) {\r\n    var time = 0;\r\n    var distance = 0;\r\n    const distanceFromTime = timing(duration);\r\n    const animation = setInterval(() => {\r\n      // Check for final condition\r\n      if (time >= duration) {\r\n        clearInterval(animation);\r\n      }\r\n      // Calculate position\r\n      const pos = pathing(distance);\r\n      // Render\r\n      element.style.left = Avoidance.math.toPctStr(pos.x);\r\n      element.style.top = Avoidance.math.toPctStr(pos.y);\r\n      // Update vars for next iteration\r\n      time = time + this.FRAME_DURATION;\r\n      distance = distanceFromTime(time);\r\n    }, this.FRAME_DURATION);\r\n  },\r\n}\r\n\r\nAvoidance.Particle = class {\r\n  constructor(element, container) {\r\n    // Save both elements\r\n    this.element = element;\r\n    this.container = container;\r\n    this.originalPosRatio = this.getPosRatio();\r\n  }\r\n  getPosRatio() {\r\n    // Get position as percentage of container to get built-in responsiveness!\r\n    const elementRect = this.element.getBoundingClientRect();\r\n    const containerRect = this.container.getBoundingClientRect();\r\n    return {\r\n      x: (elementRect.left - containerRect.left) / containerRect.width,\r\n      y: (elementRect.top - containerRect.top) / containerRect.height,\r\n    };\r\n  }\r\n  getSizeRatio() {\r\n    // Get size as percentage of container to get built-in responsiveness!\r\n    const elementRect = this.element.getBoundingClientRect();\r\n    const containerRect = this.container.getBoundingClientRect();\r\n    return {\r\n      width: elementRect.width / containerRect.width,\r\n      height: elementRect.height / containerRect.height,\r\n    };\r\n  }\r\n  dispose() {\r\n    // TODO: return particle to original location, either by setting style or removing location style\r\n  }\r\n  unfreeze() {\r\n    this.frozenStyledPosition = this.element.style.position;\r\n    const delayedUnfreezeActions = (() => {\r\n      this.element.style.position = 'absolute';\r\n      this.container.removeEventListener('mousemove', delayedUnfreezeActions);\r\n    }).bind(this);\r\n    this.container.addEventListener('mousemove', delayedUnfreezeActions);\r\n  }\r\n  freeze() {\r\n    this.element.style.position = this.element.style.position;\r\n  }\r\n}"],"names":["Avoidance","containerSelector","options","addChildrenAsParticles","containersCollection","document","querySelectorAll","containers","Array","prototype","slice","call","initOptions","trackedParticles","trackedParticleElementsSet","Set","mouseMoveHandler","bind","clickHandler","touchStartHandler","touchEndHandler","forEach","container","i","children","length","startTrackingParticleElement","status","userOptions","factorMethod","calculateAvoidanceFactor","builtinMethods","name","scale","undefined","offset","power","displacementMethod","calculateAvoidanceDisplacement","thresholdRadius","timing","animate","timings","easeOutExpo","pathing","paths","particleSelector","particleElement","querySelector","containerElement","stopTrackingParticleElements","stopTrackingParticleElement","has","body","particle","Particle","push","add","foundIdx","findIndex","element","dispose","splice","particleElements","particleElementSet","filter","registerEventHandlers","unfreeze","freeze","deregisterEventHandlers","idx","indexOf","removeChildrenAsParticles","addEventListener","removeEventListener","event","touchStarted","touchEnded","preventDefault","currentTarget","mousePos","x","pageX","offsetLeft","y","pageY","offsetTop","computeAvoidance","renderImmediateAvoidance","touchPos","renderAnimatedAvoidance","userPos","renderCallback","containerRect","getBoundingClientRect","userPosRatio","width","height","particleSizeRatio","getSizeRatio","particleCentreOrigPosRatioRelUser","originalPosRatio","particleCentreOrigDistRelUser","geometry","getRadius","avoidanceFactor","avoidanceDisplacement","getUnitVector","style","display","particleNewPos","left","math","toPctStr","top","particleOldPosRatio","getPosRatio","particleNewPosRatio","bezierQuad","linear","move","originalDistance","elementSize","method","methodFn","powerInverse","particleOrigPosRelMouse","threshold","getDistance","pointA","pointB","Math","sqrt","pow","point","radius","inverse","param_scale","param_offset","NaN","exponential","exp","param_power","param_threshold_radius","directionUnitVector","noThreshold","FRAME_DURATION","duration","t","easeOutCubic","p0","p1","s","p2","time","distance","distanceFromTime","animation","setInterval","clearInterval","pos","elementRect","frozenStyledPosition","position","delayedUnfreezeActions"],"mappings":"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"}