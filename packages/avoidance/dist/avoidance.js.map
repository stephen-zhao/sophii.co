{"version":3,"file":"avoidance.js","sources":["../src/particle.ts","../src/util.ts","../src/animate.ts","../src/geometry.ts","../src/displacing.ts","../src/thresholding.ts","../src/avoidance.js"],"sourcesContent":["import { IPositionRatio, ISizeRatio } from './dom';\r\n\r\nexport class Particle {\r\n  protected _element: HTMLElement;\r\n  protected _container: HTMLElement;\r\n  protected _originalPosRatio: IPositionRatio;\r\n\r\n  //===========================================================================\r\n  // Ctor and Dtor\r\n  //===========================================================================\r\n\r\n  constructor(element: HTMLElement, container: HTMLElement) {\r\n    // Save both elements\r\n    this._element = element;\r\n    this._container = container;\r\n    // Save the original position\r\n    this._originalPosRatio = this.getPosRatio();\r\n  }\r\n  \r\n  dispose() {\r\n    // TODO: return particle to original location, either by setting style or removing location style\r\n  }\r\n  \r\n  //===========================================================================\r\n  // Getters\r\n  //===========================================================================\r\n\r\n  get originalPosRatio(): IPositionRatio {\r\n    return this._originalPosRatio;\r\n  }\r\n\r\n  get element(): HTMLElement {\r\n    return this._element;\r\n  }\r\n\r\n  get container(): HTMLElement {\r\n    return this._container;\r\n  }\r\n\r\n  getPosRatio(): IPositionRatio {\r\n    // Get position as percentage of container to get built-in responsiveness!\r\n    const elementRect = this.element.getBoundingClientRect();\r\n    const containerRect = this.container.getBoundingClientRect();\r\n    return {\r\n      x: (elementRect.left - containerRect.left) / containerRect.width,\r\n      y: (elementRect.top - containerRect.top) / containerRect.height,\r\n    };\r\n  }\r\n  getSizeRatio(): ISizeRatio {\r\n    // Get size as percentage of container to get built-in responsiveness!\r\n    const elementRect = this.element.getBoundingClientRect();\r\n    const containerRect = this.container.getBoundingClientRect();\r\n    return {\r\n      width: elementRect.width / containerRect.width,\r\n      height: elementRect.height / containerRect.height,\r\n    };\r\n  }\r\n  \r\n  //===========================================================================\r\n  // Freezing and unfreezing the particle\r\n  //===========================================================================\r\n\r\n  private _frozenStyledPosition?: string; // a CSSStyleDeclaration.position\r\n  unfreeze() {\r\n    this._frozenStyledPosition = this.element.style.position;\r\n    const delayedUnfreezeActions = (() => {\r\n      this.element.style.position = 'absolute';\r\n      this.container.removeEventListener('mousemove', delayedUnfreezeActions);\r\n    }).bind(this);\r\n    this.container.addEventListener('mousemove', delayedUnfreezeActions);\r\n  }\r\n  freeze() {\r\n    this.element.style.position = this.element.style.position;\r\n  }\r\n}","export function floatToPctStr(x: number) {\r\n  return (100.0 * x) + \"%\";\r\n}","import { IPoint } from './geometry';\r\nimport { floatToPctStr } from './util';\r\n\r\nconst FRAME_DURATION = 10.0;\r\n\r\n// Timing functions\r\ntype TimingFn = (t: number) => number;\r\ntype TimingFnBuilder = (duration: number) => TimingFn;\r\ninterface TimingFnBuilderMap {\r\n  [key: string]: TimingFnBuilder;\r\n}\r\nexport const timings: TimingFnBuilderMap = {\r\n  linear: (duration: number) => (t: number) => t/duration,\r\n  easeOutCubic: (duration: number) => (t: number) => 1+Math.pow(t/duration-1, 3),\r\n  easeOutExpo: duration => t => 1-Math.pow(2, -10*t/duration),\r\n}\r\n\r\n// Path functions\r\ntype PathFn = (s: number) => IPoint;\r\ntype PathFnBuilder = (controlPoints: Array<IPoint>) => PathFn;\r\ninterface PathFnBuilderMap {\r\n  [key: string]: PathFnBuilder;\r\n}\r\nexport const paths: PathFnBuilderMap = {\r\n  linear: function([p0, p1]) {\r\n    return s => ({\r\n      x: p0.x + s*(p1.x - p0.x),\r\n      y: p0.y + s*(p1.y - p0.y),\r\n    });\r\n  },\r\n  bezierQuad: function([p0, p1, p2]) {\r\n    return s => ({\r\n      x: p1.x + (1.0-s)*(1.0-s)*(p0.x-p1.x) + s*s*(p2.x-p1.x),\r\n      y: p1.y + (1.0-s)*(1.0-s)*(p0.y-p1.y) + s*s*(p2.y-p1.y),\r\n    });\r\n  },\r\n}\r\n\r\nexport function move(element: HTMLElement, pathing: PathFn, duration: number, timing: TimingFnBuilder) {\r\n  var time = 0;\r\n  var distance = 0;\r\n  const distanceFromTime = timing(duration);\r\n  const animation = setInterval(() => {\r\n    // Check for final condition\r\n    if (time >= duration) {\r\n      clearInterval(animation);\r\n    }\r\n    // Calculate position\r\n    const pos = pathing(distance);\r\n    // Render\r\n    element.style.left = floatToPctStr(pos.x);\r\n    element.style.top = floatToPctStr(pos.y);\r\n    // Update vars for next iteration\r\n    time = time + FRAME_DURATION;\r\n    distance = distanceFromTime(time);\r\n  }, FRAME_DURATION);\r\n}","export interface IPoint {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport function getDistance(pointA: IPoint, pointB: IPoint) {\r\n  return Math.sqrt(Math.pow(pointA.x - pointB.x, 2) + Math.pow(pointA.y - pointB.y, 2));\r\n}\r\n\r\nexport function getRadius(point: IPoint) {\r\n    return Math.sqrt(point.x*point.x + point.y*point.y);\r\n}\r\n\r\nexport function getUnitVector(point: IPoint) {\r\n  const radius = getRadius(point);\r\n  return {\r\n    x: point.x / radius,\r\n    y: point.y / radius,\r\n  };\r\n}","export enum DisplacementFactorMethodKeys {\r\n  inverse = \"inverse\",\r\n  exponential = \"exponential\",\r\n  powerInverse = \"powerInverse\",\r\n}\r\n\r\ntype DisplacementFactorFn = (originalDistance: number, elementSize: number) => number;\r\ntype DisplacementFactorMethod = (scale: number, offset?: number, power?: number) => DisplacementFactorFn;\r\ntype DisplacementFactorMethodsMap = {\r\n  [key in DisplacementFactorMethodKeys]: DisplacementFactorMethod;\r\n}\r\nexport const builtinDisplacementFactorMethods: DisplacementFactorMethodsMap = {\r\n  inverse: function(scale=0.02, offset=0.0, power=undefined) {\r\n    return function(originalDistance, elementSize) {\r\n      if (originalDistance === 0) {\r\n        return NaN;\r\n      }\r\n      else {\r\n        return (scale*1.0)/originalDistance + offset;\r\n      }\r\n    }\r\n  },\r\n  exponential: function(scale=0.1, offset=0.0, power=undefined) {\r\n    return function(originalDistance, elementSize) {\r\n      return Math.exp(scale-originalDistance) + offset;\r\n    }\r\n  },\r\n  powerInverse: function(scale=0.02, offset=0.0, power=0.6) {\r\n    return function(originalDistance, elementSize) {\r\n      if (originalDistance === 0) {\r\n        return NaN;\r\n      }\r\n      else {\r\n        return ((scale*1.0)/Math.pow(originalDistance*1.0, power) + offset);\r\n      }\r\n    }\r\n  }\r\n}","import { IPoint, getRadius } from './geometry'\r\n\r\nexport enum ThresholdingMethodKeys {\r\n  threshold = \"threshold\",\r\n  noThreshold = \"noThreshold\",\r\n}\r\n\r\ntype ThresholdingFn = (directionUnitVector: IPoint, avoidanceFactor: number) => IPoint | null;\r\ntype ThresholdingMethod = (thresholdRadius?: number) => ThresholdingFn;\r\ntype ThresholdingMethodsMap = {\r\n  [key in ThresholdingMethodKeys]: ThresholdingMethod;\r\n}\r\nexport const builtinThresholdingMethods: ThresholdingMethodsMap = {\r\n  threshold: function(thresholdRadius=0.1) {\r\n    return function(directionUnitVector: IPoint, avoidanceFactor: number) {\r\n      if (avoidanceFactor === NaN) {\r\n        return null;\r\n      }\r\n      var offset = {\r\n        x: directionUnitVector.x*avoidanceFactor,\r\n        y: directionUnitVector.y*avoidanceFactor,\r\n      };\r\n      if (getRadius(offset) > thresholdRadius) {\r\n        return {\r\n          x: directionUnitVector.x*thresholdRadius,\r\n          y: directionUnitVector.y*thresholdRadius,\r\n        };\r\n      }\r\n      else {\r\n        return offset;\r\n      }\r\n    }\r\n  },\r\n  noThreshold: function(thresholdRadius=undefined) {\r\n    return function(directionUnitVector: IPoint, avoidanceFactor: number) {\r\n      if (avoidanceFactor === NaN) {\r\n        return null;\r\n      }\r\n      return {\r\n        x: directionUnitVector.x*avoidanceFactor,\r\n        y: directionUnitVector.y*avoidanceFactor,\r\n      };\r\n    }\r\n  }\r\n}","// avoidance.js\r\n// AUTHOR: Stephen Zhao\r\n// REPO: github.com/stephen-zhao/sophii.co\r\n\r\n// A standalone library for creating \"avoidance cloud\" effect.\r\n// All children of given containers will be animated to avoid the user's mouse.\r\n\r\nimport { Particle } from './particle';\r\nimport * as animate from './animate';\r\nimport * as geometry from './geometry';\r\nimport * as util from './util';\r\nimport { builtinDisplacementFactorMethods } from './displacing';\r\nimport { builtinThresholdingMethods } from './thresholding';\r\n\r\n// The class which exposes the public API\r\nexport default class Avoidance {\r\n  // input:\r\n  //   containerSelector\r\n  //    - css-selector string which specifies the elements\r\n  //      inside which the avoidance effect is triggered.\r\n  //   options\r\n  //    - an settings object that takes the following *optional* key/values:\r\n  //      factorMethod: {\r\n  //        name: one of \"inverse\", \"powerInverse\", or \"exponential\"\r\n  //        scale: a number\r\n  //        offset: a number\r\n  //        power: a number\r\n  //      },\r\n  //      displacementMethod: {\r\n  //        name: one of \"noThreshold\" or \"threshold\"\r\n  //        thresholdRadius: a number\r\n  //      },\r\n  //      timing: one of\r\n  //        \"linear\", \"easeOutCubic\", \"easeOutExpo\"\r\n  //      pathing: one of\r\n  //        \"linear\", \"bezierQuad\"\r\n  //   addChildrenAsParticles\r\n  //    - boolean which specifies whether or not the children\r\n  //      of the containers are added initially as tracked\r\n  //      particles. Defaults to true.\r\n  constructor(containerSelector, options = {}, addChildrenAsParticles = true) {\r\n    // save the containers\r\n    var containersCollection = document.querySelectorAll(containerSelector);\r\n    this.containers = Array.prototype.slice.call(containersCollection);\r\n    // save options for future use\r\n    this.options = this.initOptions(options);\r\n    // init tracked particles\r\n    this.trackedParticles = [];\r\n    this.trackedParticleElementsSet = new Set();\r\n    // \"fix\" event listeners\r\n    this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\r\n    this.clickHandler = this.clickHandler.bind(this);\r\n    this.touchStartHandler = this.touchStartHandler.bind(this);\r\n    this.touchEndHandler = this.touchEndHandler.bind(this);\r\n    // Create particles from all of the container's children\r\n    // and add them to the list of tracked particles, if specified to do so\r\n    if (addChildrenAsParticles) {\r\n      this.containers.forEach(function (container) {\r\n        for (var i = 0; i < container.children.length; ++i) {\r\n          this.startTrackingParticleElement(container.children[i], container);\r\n        }\r\n      }, this);\r\n    }\r\n    // set the initial status\r\n    this.status = \"ready\";\r\n  }\r\n\r\n  initOptions(userOptions) {\r\n    var options = {};\r\n\r\n    // Process factorMethod option\r\n    options.factorMethod = {};\r\n    if (\"factorMethod\" in userOptions) {\r\n      if (typeof userOptions.factorMethod === \"string\"\r\n          && (userOptions.factorMethod in builtinDisplacementFactorMethods)) {\r\n        options.factorMethod.name = userOptions.factorMethod;\r\n        options.factorMethod.scale = undefined;\r\n        options.factorMethod.offset = undefined;\r\n        options.factorMethod.power = undefined;\r\n      }\r\n      else if (typeof userOptions.factorMethod === \"object\") {\r\n        if ((\"name\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.name === \"string\")\r\n            && (userOptions.factorMethod.name in builtinDisplacementFactorMethods)) {\r\n          options.factorMethod.name = userOptions.factorMethod.name;\r\n        }\r\n        else {\r\n          options.factorMethod.name = undefined;\r\n        }\r\n        if ((\"scale\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.scale === \"number\")) {\r\n          options.factorMethod.scale = userOptions.factorMethod.scale;\r\n        }\r\n        else {\r\n          options.factorMethod.scale = undefined;\r\n        }\r\n        if ((\"offset\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.offset === \"number\")) {\r\n          options.factorMethod.offset = userOptions.factorMethod.offset;\r\n        }\r\n        else {\r\n          options.factorMethod.offset = undefined;\r\n        }\r\n        if ((\"power\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.power === \"number\")) {\r\n          options.factorMethod.power = userOptions.factorMethod.power;\r\n        }\r\n        else {\r\n          options.factorMethod.power = undefined;\r\n        }\r\n      }\r\n      else {\r\n        options.factorMethod.name = undefined;\r\n        options.factorMethod.scale = undefined;\r\n        options.factorMethod.offset = undefined;\r\n        options.factorMethod.power = undefined;\r\n      }\r\n    }\r\n\r\n    // Process displacementMethod\r\n    options.displacementMethod = {};\r\n    if (\"displacementMethod\" in userOptions) {\r\n      if (typeof userOptions.displacementMethod === \"string\"\r\n          && (userOptions.displacementMethod in builtinThresholdingMethods)) {\r\n        options.displacementMethod.name = userOptions.displacementMethod;\r\n        options.displacementMethod.thresholdRadius = undefined;\r\n      }\r\n      else if (typeof userOptions.displacementMethod === \"object\") {\r\n        if ((\"name\" in userOptions.displacementMethod)\r\n            && (typeof userOptions.displacementMethod.name === \"string\")\r\n            && (userOptions.displacementMethod.name in builtinThresholdingMethods)) {\r\n          options.displacementMethod.name = userOptions.displacementMethod.name;\r\n        }\r\n        else {\r\n          options.displacementMethod.name = undefined;\r\n        }\r\n        if ((\"thresholdRadius\" in userOptions.displacementMethod)\r\n            && (typeof userOptions.displacementMethod.thresholdRadius === \"number\")) {\r\n          options.displacementMethod.thresholdRadius = userOptions.displacementMethod.thresholdRadius;\r\n        }\r\n        else {\r\n          options.displacementMethod.thresholdRadius = undefined;\r\n        }\r\n      }\r\n      else {\r\n        options.displacementMethod.name = undefined;\r\n        options.displacementMethod.thresholdRadius = undefined;\r\n      }\r\n    }\r\n\r\n    // Process timings\r\n    if (\"timing\" in userOptions\r\n        && (typeof userOptions.timing === \"string\")\r\n        && (userOptions.timing in animate.timings)) {\r\n      options.timing = animate.timings[userOptions.timing];\r\n    }\r\n    else {\r\n      options.timing = animate.timings.easeOutExpo;\r\n    }\r\n    \r\n    // Process pathing\r\n    if (\"pathing\" in userOptions\r\n        && (typeof userOptions.pathing === \"string\")\r\n        && (userOptions.pathing in animate.paths)) {\r\n      options.pathing = userOptions.pathing;\r\n    }\r\n    else {\r\n      options.pathing = \"bezierQuad\";\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  addParticles(particleSelector, containerSelector) {\r\n    document.querySelectorAll(particleSelector).forEach(particleElement => {\r\n      this.startTrackingParticleElement(particleElement, containerSelector ? document.querySelector(containerSelector) : undefined);\r\n    }, this);\r\n  }\r\n\r\n  addParticleElement(particleElement, containerElement) {\r\n    this.startTrackingParticleElement(particleElement, containerElement);\r\n  }\r\n\r\n  removeParticles(particleSelector) {\r\n    this.stopTrackingParticleElements(document.querySelectorAll(particleSelector));\r\n  }\r\n\r\n  removeParticleElement(particleElement) {\r\n    this.stopTrackingParticleElement(particleElement);\r\n  }\r\n\r\n  startTrackingParticleElement(particleElement, containerElement) {\r\n    if (!this.trackedParticleElementsSet.has(particleElement)) {\r\n      if (!containerElement) {\r\n        containerElement = document.body;\r\n      }\r\n      var particle = new Particle(particleElement, containerElement);\r\n      this.trackedParticles.push(particle);\r\n      this.trackedParticleElementsSet.add(particleElement);\r\n    }\r\n  }\r\n\r\n  stopTrackingParticleElement(particleElement) {\r\n    if (this.trackedParticleElementsSet.has(particleElement)) {\r\n      // First remove from lookup set\r\n      this.trackedParticleElementsSet.delete(particleElement);\r\n      var foundIdx = this.trackedParticles.findIndex(function(particle) {\r\n        return particle.element === particleElement;\r\n      });\r\n      if (foundIdx !== -1) {\r\n        // Then dispose\r\n        this.trackedParticles[foundIdx].dispose();\r\n        // Then remove from tracked particles\r\n        this.trackedParticles.splice(foundIdx, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  stopTrackingParticleElements(particleElements) {\r\n    var particleElementSet = new Set(particleElements);\r\n    for (var i = 0; i < this.trackedParticles.length; ++i) {\r\n      if (particleElementSet.has(this.trackedParticles[i].element)) {\r\n        // First remove from lookup set\r\n        this.trackedParticleElementsSet.delete(this.trackedParticles[i].element);\r\n        // Then dispose\r\n        this.trackedParticles[i].dispose();\r\n        // Then remove from tracked particles\r\n        this.trackedParticles[i] = \"removed\";\r\n      }\r\n    }\r\n    // Realize the removal\r\n    this.trackedParticles = this.trackedParticles.filter(function(particle) {\r\n      return particle !== \"removed\";\r\n    });\r\n  }\r\n\r\n  start() {\r\n    // Add all event handlers to each container\r\n    this.containers.forEach(this.registerEventHandlers, this);\r\n    // Let particles know movement has started\r\n    this.trackedParticles.forEach(particle => {\r\n      particle.unfreeze();\r\n    });\r\n    this.status = \"running\";\r\n  }\r\n\r\n  stop() {\r\n    // Let all particles know to stop\r\n    this.trackedParticles.forEach(particle => {\r\n      particle.freeze();\r\n    });\r\n    // remove all event handlers from each container\r\n    this.containers.forEach(this.deregisterEventHandlers, this);\r\n    this.status = \"stopped\";\r\n  }\r\n\r\n  addContainers(containerSelector, addChildrenAsParticles = true) {\r\n    // Split work by processing each selected container iteratively\r\n    var containersCollection = document.querySelectorAll(containerSelector);\r\n    containersCollection.forEach(function(container) {\r\n      // Only add if not already added\r\n      var idx = this.containers.indexOf(container);\r\n      if (idx >= 0) {\r\n        return;\r\n      }\r\n      this.containers.push(container);\r\n      // Add children as particles if specified to do so\r\n      if (addChildrenAsParticles) {\r\n        for (var i = 0; i < container.children.length; ++i) {\r\n          this.startTrackingParticleElement(container.children[i]);\r\n        }\r\n      }\r\n      // Register handlers if we are already running\r\n      if (this.status === \"running\") {\r\n        this.registerEventHandlers(container);\r\n      }\r\n    }, this);\r\n  }\r\n\r\n  removeContainers(containerSelector, removeChildrenAsParticles = true) {\r\n    // Process each selected container iteratively\r\n    var containersCollection = document.querySelectorAll(containerSelector);\r\n    containersCollection.forEach(function(container) {\r\n      // Process only if the container is tracked\r\n      var idx = this.containers.indexOf(container);\r\n      if (idx < 0) {\r\n        return;\r\n      }\r\n      // Remove children as particles if specified to do so\r\n      if (removeChildrenAsParticles) {\r\n        this.stopTrackingParticleElements(container.children);\r\n      }\r\n      // Deregister events if we are running\r\n      if (this.status === \"running\") {\r\n        this.deregisterEventHandlers(container);\r\n      }\r\n      // Remove from tracked containers\r\n      this.containers.splice(idx, 1);\r\n    }, this);\r\n  }\r\n\r\n  registerEventHandlers(container) {\r\n    container.addEventListener(\"touchend\", this.touchEndHandler);\r\n    container.addEventListener(\"touchstart\", this.touchStartHandler);\r\n    container.addEventListener(\"mousemove\", this.mouseMoveHandler);\r\n    container.addEventListener(\"click\", this.clickHandler);\r\n  }\r\n\r\n  deregisterEventHandlers(container) {\r\n    container.removeEventListener(\"click\", this.clickHandler);\r\n    container.removeEventListener(\"mousemove\", this.mouseMoveHandler);\r\n    container.removeEventListener(\"touchstart\", this.touchStartHandler);\r\n    container.removeEventListener(\"touchend\", this.touchEndHandler);\r\n  }\r\n\r\n  mouseMoveHandler(event) {\r\n    if (this.touchStarted || this.touchEnded) {\r\n      // Do not handle a mouseMove for touch events\r\n      event.preventDefault();\r\n    }\r\n    else {\r\n      const container = event.currentTarget;\r\n      const mousePos = { x: event.pageX - container.offsetLeft, y: event.pageY - container.offsetTop };\r\n      this.computeAvoidance(container, mousePos, this.renderImmediateAvoidance.bind(this));\r\n    }\r\n  }\r\n\r\n  clickHandler(event) {\r\n    if (this.touchStarted || this.touchEnded) {\r\n      const container = event.currentTarget;\r\n      const touchPos = { x: event.pageX - container.offsetLeft, y: event.pageY - container.offsetTop };\r\n      this.computeAvoidance(container, touchPos, this.renderAnimatedAvoidance.bind(this));\r\n      this.touchStarted = false;\r\n      this.touchEnded = false;\r\n    }\r\n    else {\r\n      // click, but not touched\r\n    }\r\n  }\r\n\r\n  touchStartHandler(event) {\r\n    this.touchStarted = true;\r\n  }\r\n\r\n  touchEndHandler(event) {\r\n    this.touchEnded = true;\r\n  }\r\n\r\n  computeAvoidance(container, userPos, renderCallback) {\r\n    const containerRect = container.getBoundingClientRect();\r\n    const userPosRatio = {\r\n      x: userPos.x / containerRect.width,\r\n      y: userPos.y / containerRect.height,\r\n    };\r\n    this.trackedParticles.forEach(function (particle) {\r\n      const particleSizeRatio = particle.getSizeRatio();\r\n      const particleCentreOrigPosRatioRelUser = {\r\n        x: particle.originalPosRatio.x + particleSizeRatio.width*1.0 / 2 - userPosRatio.x,\r\n        y: particle.originalPosRatio.y + particleSizeRatio.height*1.0 / 2 - userPosRatio.y,\r\n      };\r\n      const particleCentreOrigDistRelUser = geometry.getRadius(particleCentreOrigPosRatioRelUser);\r\n      const avoidanceFactor = this.calculateAvoidanceFactor(particleCentreOrigDistRelUser, particleSizeRatio);\r\n      const avoidanceDisplacement = this.calculateAvoidanceDisplacement(\r\n        geometry.getUnitVector(particleCentreOrigPosRatioRelUser), avoidanceFactor);\r\n      renderCallback(avoidanceDisplacement, particle);\r\n    }, this);\r\n  }\r\n\r\n  renderImmediateAvoidance(avoidanceDisplacement, particle) {\r\n    if (avoidanceDisplacement === null) {\r\n      particle.element.style.display = \"none\";\r\n    }\r\n    else {\r\n      const particleNewPos = {\r\n        x: particle.originalPosRatio.x + avoidanceDisplacement.x,\r\n        y: particle.originalPosRatio.y + avoidanceDisplacement.y,\r\n      };\r\n      if (particle.element.style.display === \"none\") {\r\n        particle.element.style.display = \"\";\r\n      }\r\n      particle.element.style.left = util.floatToPctStr(particleNewPos.x);\r\n      particle.element.style.top = util.floatToPctStr(particleNewPos.y);\r\n    }\r\n  }\r\n\r\n  renderAnimatedAvoidance(avoidanceDisplacement, particle) {\r\n    if (avoidanceDisplacement === null) {\r\n      particle.element.style.display = \"none\";\r\n    }\r\n    else {\r\n      const particleOldPosRatio = particle.getPosRatio();\r\n      const particleNewPosRatio = {\r\n        x: particle.originalPosRatio.x + avoidanceDisplacement.x,\r\n        y: particle.originalPosRatio.y + avoidanceDisplacement.y,\r\n      };\r\n      if (particle.element.style.display === \"none\") {\r\n        particle.element.style.display = \"\";\r\n      }\r\n      const pathing = this.options.pathing === \"bezierQuad\"\r\n        ? animate.paths.bezierQuad(particleOldPosRatio, particle.originalPosRatio, particleNewPosRatio)\r\n        : animate.paths.linear(particleOldPosRatio, particleNewPosRatio);\r\n      animate.move(particle.element, pathing, 1000, this.options.timing);\r\n    }\r\n  }\r\n\r\n  calculateAvoidanceFactor(originalDistance, elementSize, method) {\r\n    if (method === undefined) {\r\n      method = this.options.factorMethod.name;\r\n    }\r\n    var methodFn = null;\r\n    if (method !== undefined) {\r\n      methodFn = builtinDisplacementFactorMethods[method];\r\n    }\r\n    else {\r\n      methodFn = builtinDisplacementFactorMethods.powerInverse;\r\n    }\r\n    return methodFn(\r\n      this.options.factorMethod.scale,\r\n      this.options.factorMethod.offset,\r\n      this.options.factorMethod.power\r\n    )(originalDistance, elementSize);\r\n  }\r\n  \r\n  calculateAvoidanceDisplacement(particleOrigPosRelMouse, avoidanceFactor, method) {\r\n    if (method === undefined) {\r\n      method = this.options.displacementMethod.name;\r\n    }\r\n    var methodFn = null;\r\n    if (method !== undefined) {\r\n      methodFn = builtinThresholdingMethods[method];\r\n    }\r\n    else {\r\n      methodFn = builtinThresholdingMethods.threshold;\r\n    }\r\n    return methodFn(\r\n      this.options.displacementMethod.thresholdRadius\r\n    )(particleOrigPosRelMouse, avoidanceFactor);\r\n  }\r\n}"],"names":["Particle","element","container","_element","_container","_originalPosRatio","getPosRatio","elementRect","getBoundingClientRect","containerRect","x","left","width","y","top","height","_frozenStyledPosition","style","position","delayedUnfreezeActions","removeEventListener","bind","addEventListener","floatToPctStr","FRAME_DURATION","timings","linear","duration","t","easeOutCubic","Math","pow","easeOutExpo","paths","p0","p1","s","bezierQuad","p2","move","pathing","timing","time","distance","distanceFromTime","animation","setInterval","clearInterval","pos","getRadius","point","sqrt","getUnitVector","radius","DisplacementFactorMethodKeys","builtinDisplacementFactorMethods","inverse","scale","offset","originalDistance","elementSize","NaN","exponential","exp","powerInverse","power","ThresholdingMethodKeys","builtinThresholdingMethods","threshold","thresholdRadius","directionUnitVector","avoidanceFactor","noThreshold","Avoidance","containerSelector","options","addChildrenAsParticles","containersCollection","document","querySelectorAll","containers","Array","prototype","slice","call","initOptions","trackedParticles","trackedParticleElementsSet","Set","mouseMoveHandler","clickHandler","touchStartHandler","touchEndHandler","forEach","i","children","length","startTrackingParticleElement","status","userOptions","factorMethod","name","undefined","displacementMethod","animate","particleSelector","particleElement","querySelector","containerElement","stopTrackingParticleElements","stopTrackingParticleElement","has","body","particle","push","add","foundIdx","findIndex","dispose","splice","particleElements","particleElementSet","filter","registerEventHandlers","unfreeze","freeze","deregisterEventHandlers","idx","indexOf","removeChildrenAsParticles","event","touchStarted","touchEnded","preventDefault","currentTarget","mousePos","pageX","offsetLeft","pageY","offsetTop","computeAvoidance","renderImmediateAvoidance","touchPos","renderAnimatedAvoidance","userPos","renderCallback","userPosRatio","particleSizeRatio","getSizeRatio","particleCentreOrigPosRatioRelUser","originalPosRatio","particleCentreOrigDistRelUser","geometry","calculateAvoidanceFactor","avoidanceDisplacement","calculateAvoidanceDisplacement","display","particleNewPos","util","particleOldPosRatio","particleNewPosRatio","method","methodFn","particleOrigPosRelMouse"],"mappings":"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"}