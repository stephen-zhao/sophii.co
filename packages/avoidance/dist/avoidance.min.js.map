{"version":3,"file":"avoidance.min.js","sources":["../src/avoidance.js"],"sourcesContent":["// avoidance.js\r\n// AUTHOR: Stephen Zhao\r\n// REPO: github.com/stephen-zhao/sophii.co\r\n\r\n// A standalone library for creating \"avoidance cloud\" effect.\r\n// All children of given containers will be animated to avoid the user's mouse.\r\n\r\n// The class which exposes the public API\r\nexport default class Avoidance {\r\n  // input:\r\n  //   containerSelector\r\n  //    - css-selector string which specifies the elements\r\n  //      inside which the avoidance effect is triggered.\r\n  //   options\r\n  //    - an settings object that takes the following *optional* key/values:\r\n  //      factorMethod: {\r\n  //        name: one of \"inverse\", \"powerInverse\", or \"exponential\"\r\n  //        scale: a number\r\n  //        offset: a number\r\n  //        power: a number\r\n  //      },\r\n  //      displacementMethod: {\r\n  //        name: one of \"noThreshold\" or \"threshold\"\r\n  //        thresholdRadius: a number\r\n  //      },\r\n  //      timing: one of\r\n  //        \"linear\", \"easeOutCubic\", \"easeOutExpo\"\r\n  //      pathing: one of\r\n  //        \"linear\", \"bezierQuad\"\r\n  //   addChildrenAsParticles\r\n  //    - boolean which specifies whether or not the children\r\n  //      of the containers are added initially as tracked\r\n  //      particles. Defaults to true.\r\n  constructor(containerSelector, options = {}, addChildrenAsParticles = true) {\r\n    // save the containers\r\n    var containersCollection = document.querySelectorAll(containerSelector);\r\n    this.containers = Array.prototype.slice.call(containersCollection);\r\n    // save options for future use\r\n    this.options = this.initOptions(options);\r\n    // init tracked particles\r\n    this.trackedParticles = [];\r\n    this.trackedParticleElementsSet = new Set();\r\n    // \"fix\" event listeners\r\n    this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\r\n    this.clickHandler = this.clickHandler.bind(this);\r\n    this.touchStartHandler = this.touchStartHandler.bind(this);\r\n    this.touchEndHandler = this.touchEndHandler.bind(this);\r\n    // Create particles from all of the container's children\r\n    // and add them to the list of tracked particles, if specified to do so\r\n    if (addChildrenAsParticles) {\r\n      this.containers.forEach(function (container) {\r\n        for (var i = 0; i < container.children.length; ++i) {\r\n          this.startTrackingParticleElement(container.children[i], container);\r\n        }\r\n      }, this);\r\n    }\r\n    // set the initial status\r\n    this.status = \"ready\";\r\n  }\r\n\r\n  initOptions(userOptions) {\r\n    var options = {};\r\n\r\n    // Process factorMethod option\r\n    options.factorMethod = {};\r\n    if (\"factorMethod\" in userOptions) {\r\n      if (typeof userOptions.factorMethod === \"string\"\r\n          && (userOptions.factorMethod in Avoidance.calculateAvoidanceFactor.builtinMethods)) {\r\n        options.factorMethod.name = userOptions.factorMethod;\r\n        options.factorMethod.scale = undefined;\r\n        options.factorMethod.offset = undefined;\r\n        options.factorMethod.power = undefined;\r\n      }\r\n      else if (typeof userOptions.factorMethod === \"object\") {\r\n        if ((\"name\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.name === \"string\")\r\n            && (userOptions.factorMethod.name in Avoidance.calculateAvoidanceFactor.builtinMethods)) {\r\n          options.factorMethod.name = userOptions.factorMethod.name;\r\n        }\r\n        else {\r\n          options.factorMethod.name = undefined;\r\n        }\r\n        if ((\"scale\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.scale === \"number\")) {\r\n          options.factorMethod.scale = userOptions.factorMethod.scale;\r\n        }\r\n        else {\r\n          options.factorMethod.scale = undefined;\r\n        }\r\n        if ((\"offset\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.offset === \"number\")) {\r\n          options.factorMethod.offset = userOptions.factorMethod.offset;\r\n        }\r\n        else {\r\n          options.factorMethod.offset = undefined;\r\n        }\r\n        if ((\"power\" in userOptions.factorMethod)\r\n            && (typeof userOptions.factorMethod.power === \"number\")) {\r\n          options.factorMethod.power = userOptions.factorMethod.power;\r\n        }\r\n        else {\r\n          options.factorMethod.power = undefined;\r\n        }\r\n      }\r\n      else {\r\n        options.factorMethod.name = undefined;\r\n        options.factorMethod.scale = undefined;\r\n        options.factorMethod.offset = undefined;\r\n        options.factorMethod.power = undefined;\r\n      }\r\n    }\r\n\r\n    // Process displacementMethod\r\n    options.displacementMethod = {};\r\n    if (\"displacementMethod\" in userOptions) {\r\n      if (typeof userOptions.displacementMethod === \"string\"\r\n          && (userOptions.displacementMethod in Avoidance.calculateAvoidanceDisplacement.builtinMethods)) {\r\n        options.displacementMethod.name = userOptions.displacementMethod;\r\n        options.displacementMethod.thresholdRadius = undefined;\r\n      }\r\n      else if (typeof userOptions.displacementMethod === \"object\") {\r\n        if ((\"name\" in userOptions.displacementMethod)\r\n            && (typeof userOptions.displacementMethod.name === \"string\")\r\n            && (userOptions.displacementMethod.name in Avoidance.calculateAvoidanceDisplacement.builtinMethods)) {\r\n          options.displacementMethod.name = userOptions.displacementMethod.name;\r\n        }\r\n        else {\r\n          options.displacementMethod.name = undefined;\r\n        }\r\n        if ((\"thresholdRadius\" in userOptions.displacementMethod)\r\n            && (typeof userOptions.displacementMethod.thresholdRadius === \"number\")) {\r\n          options.displacementMethod.thresholdRadius = userOptions.displacementMethod.thresholdRadius;\r\n        }\r\n        else {\r\n          options.displacementMethod.thresholdRadius = undefined;\r\n        }\r\n      }\r\n      else {\r\n        options.displacementMethod.name = undefined;\r\n        options.displacementMethod.thresholdRadius = undefined;\r\n      }\r\n    }\r\n\r\n    // Process timings\r\n    if (\"timing\" in userOptions\r\n        && (typeof userOptions.timing === \"string\")\r\n        && (userOptions.timing in Avoidance.animate.timings)) {\r\n      options.timing = Avoidance.animate.timings[userOptions.timing];\r\n    }\r\n    else {\r\n      options.timing = Avoidance.animate.timings.easeOutExpo;\r\n    }\r\n    \r\n    // Process pathing\r\n    if (\"pathing\" in userOptions\r\n        && (typeof userOptions.pathing === \"string\")\r\n        && (userOptions.pathing in Avoidance.animate.paths)) {\r\n      options.pathing = userOptions.pathing;\r\n    }\r\n    else {\r\n      options.pathing = \"bezierQuad\";\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  addParticles(particleSelector, containerSelector) {\r\n    document.querySelectorAll(particleSelector).forEach(particleElement => {\r\n      this.startTrackingParticleElement(particleElement, containerSelector ? document.querySelector(containerSelector) : undefined);\r\n    }, this);\r\n  }\r\n\r\n  addParticleElement(particleElement, containerElement) {\r\n    this.startTrackingParticleElement(particleElement, containerElement);\r\n  }\r\n\r\n  removeParticles(particleSelector) {\r\n    this.stopTrackingParticleElements(document.querySelectorAll(particleSelector));\r\n  }\r\n\r\n  removeParticleElement(particleElement) {\r\n    this.stopTrackingParticleElement(particleElement);\r\n  }\r\n\r\n  startTrackingParticleElement(particleElement, containerElement) {\r\n    if (!this.trackedParticleElementsSet.has(particleElement)) {\r\n      if (!containerElement) {\r\n        containerElement = document.body;\r\n      }\r\n      var particle = new Avoidance.Particle(particleElement, containerElement);\r\n      this.trackedParticles.push(particle);\r\n      this.trackedParticleElementsSet.add(particleElement);\r\n    }\r\n  }\r\n\r\n  stopTrackingParticleElement(particleElement) {\r\n    if (this.trackedParticleElementsSet.has(particleElement)) {\r\n      // First remove from lookup set\r\n      this.trackedParticleElementsSet.delete(particleElement);\r\n      var foundIdx = this.trackedParticles.findIndex(function(particle) {\r\n        return particle.element === particleElement;\r\n      });\r\n      if (foundIdx !== -1) {\r\n        // Then dispose\r\n        this.trackedParticles[foundIdx].dispose();\r\n        // Then remove from tracked particles\r\n        this.trackedParticles.splice(foundIdx, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  stopTrackingParticleElements(particleElements) {\r\n    var particleElementSet = new Set(particleElements);\r\n    for (var i = 0; i < this.trackedParticles.length; ++i) {\r\n      if (particleElementSet.has(this.trackedParticles[i].element)) {\r\n        // First remove from lookup set\r\n        this.trackedParticleElementsSet.delete(this.trackedParticles[i].element);\r\n        // Then dispose\r\n        this.trackedParticles[i].dispose();\r\n        // Then remove from tracked particles\r\n        this.trackedParticles[i] = \"removed\";\r\n      }\r\n    }\r\n    // Realize the removal\r\n    this.trackedParticles = this.trackedParticles.filter(function(particle) {\r\n      return particle !== \"removed\";\r\n    });\r\n  }\r\n\r\n  start() {\r\n    // Add all event handlers to each container\r\n    this.containers.forEach(this.registerEventHandlers, this);\r\n    this.status = \"running\";\r\n  }\r\n\r\n  stop() {\r\n    // remove all event handlers from each container\r\n    this.containers.forEach(this.deregisterEventHandlers, this);\r\n    this.status = \"stopped\";\r\n  }\r\n\r\n  addContainers(containerSelector, addChildrenAsParticles = true) {\r\n    // Split work by processing each selected container iteratively\r\n    var containersCollection = document.querySelectorAll(containerSelector);\r\n    containersCollection.forEach(function(container) {\r\n      // Only add if not already added\r\n      var idx = this.containers.indexOf(container);\r\n      if (idx >= 0) {\r\n        return;\r\n      }\r\n      this.containers.push(container);\r\n      // Add children as particles if specified to do so\r\n      if (addChildrenAsParticles) {\r\n        for (var i = 0; i < container.children.length; ++i) {\r\n          this.startTrackingParticleElement(container.children[i]);\r\n        }\r\n      }\r\n      // Register handlers if we are already running\r\n      if (this.status === \"running\") {\r\n        this.registerEventHandlers(container);\r\n      }\r\n    }, this);\r\n  }\r\n\r\n  removeContainers(containerSelector, removeChildrenAsParticles = true) {\r\n    // Process each selected container iteratively\r\n    var containersCollection = document.querySelectorAll(containerSelector);\r\n    containersCollection.forEach(function(container) {\r\n      // Process only if the container is tracked\r\n      var idx = this.containers.indexOf(container);\r\n      if (idx < 0) {\r\n        return;\r\n      }\r\n      // Remove children as particles if specified to do so\r\n      if (removeChildrenAsParticles) {\r\n        this.stopTrackingParticleElements(container.children);\r\n      }\r\n      // Deregister events if we are running\r\n      if (this.status === \"running\") {\r\n        this.deregisterEventHandlers(container);\r\n      }\r\n      // Remove from tracked containers\r\n      this.containers.splice(idx, 1);\r\n    }, this);\r\n  }\r\n\r\n  registerEventHandlers(container) {\r\n    container.addEventListener(\"touchend\", this.touchEndHandler);\r\n    container.addEventListener(\"touchstart\", this.touchStartHandler);\r\n    container.addEventListener(\"mousemove\", this.mouseMoveHandler);\r\n    container.addEventListener(\"click\", this.clickHandler);\r\n  }\r\n\r\n  deregisterEventHandlers(container) {\r\n    container.removeEventListener(\"click\", this.clickHandler);\r\n    container.removeEventListener(\"mousemove\", this.mouseMoveHandler);\r\n    container.removeEventListener(\"touchstart\", this.touchStartHandler);\r\n    container.removeEventListener(\"touchend\", this.touchEndHandler);\r\n  }\r\n\r\n  mouseMoveHandler(event) {\r\n    if (this.touchStarted || this.touchEnded) {\r\n      // Do not handle a mouseMove for touch events\r\n      event.preventDefault();\r\n    }\r\n    else {\r\n      const container = event.currentTarget;\r\n      const mousePos = { x: event.pageX - container.offsetLeft, y: event.pageY - container.offsetTop };\r\n      this.computeAvoidance(container, mousePos, this.renderImmediateAvoidance.bind(this));\r\n    }\r\n  }\r\n\r\n  clickHandler(event) {\r\n    if (this.touchStarted || this.touchEnded) {\r\n      const container = event.currentTarget;\r\n      const touchPos = { x: event.pageX - container.offsetLeft, y: event.pageY - container.offsetTop };\r\n      this.computeAvoidance(container, touchPos, this.renderAnimatedAvoidance.bind(this));\r\n      this.touchStarted = false;\r\n      this.touchEnded = false;\r\n    }\r\n    else {\r\n      // click, but not touched\r\n    }\r\n  }\r\n\r\n  touchStartHandler(event) {\r\n    this.touchStarted = true;\r\n  }\r\n\r\n  touchEndHandler(event) {\r\n    this.touchEnded = true;\r\n  }\r\n\r\n  computeAvoidance(container, userPos, renderCallback) {\r\n    const containerRect = container.getBoundingClientRect();\r\n    const userPosRatio = {\r\n      x: userPos.x / containerRect.width,\r\n      y: userPos.y / containerRect.height,\r\n    };\r\n    this.trackedParticles.forEach(function (particle) {\r\n      const particleSizeRatio = particle.getSizeRatio();\r\n      const particleCentreOrigPosRatioRelUser = {\r\n        x: particle.originalPosRatio.x + particleSizeRatio.width*1.0 / 2 - userPosRatio.x,\r\n        y: particle.originalPosRatio.y + particleSizeRatio.height*1.0 / 2 - userPosRatio.y,\r\n      };\r\n      const particleCentreOrigDistRelUser = Avoidance.geometry.getRadius(particleCentreOrigPosRatioRelUser);\r\n      const avoidanceFactor = this.calculateAvoidanceFactor(particleCentreOrigDistRelUser, particleSizeRatio);\r\n      const avoidanceDisplacement = this.calculateAvoidanceDisplacement(\r\n        Avoidance.geometry.getUnitVector(particleCentreOrigPosRatioRelUser), avoidanceFactor);\r\n      renderCallback(avoidanceDisplacement, particle);\r\n    }, this);\r\n  }\r\n\r\n  renderImmediateAvoidance(avoidanceDisplacement, particle) {\r\n    if (avoidanceDisplacement === null) {\r\n      particle.element.style.display = \"none\";\r\n    }\r\n    else {\r\n      const particleNewPos = {\r\n        x: particle.originalPosRatio.x + avoidanceDisplacement.x,\r\n        y: particle.originalPosRatio.y + avoidanceDisplacement.y,\r\n      };\r\n      if (particle.element.style.display === \"none\") {\r\n        particle.element.style.display = \"\";\r\n      }\r\n      particle.element.style.left = Avoidance.math.toPctStr(particleNewPos.x);\r\n      particle.element.style.top = Avoidance.math.toPctStr(particleNewPos.y);\r\n    }\r\n  }\r\n\r\n  renderAnimatedAvoidance(avoidanceDisplacement, particle) {\r\n    if (avoidanceDisplacement === null) {\r\n      particle.element.style.display = \"none\";\r\n    }\r\n    else {\r\n      const particleOldPosRatio = particle.getPosRatio();\r\n      const particleNewPosRatio = {\r\n        x: particle.originalPosRatio.x + avoidanceDisplacement.x,\r\n        y: particle.originalPosRatio.y + avoidanceDisplacement.y,\r\n      };\r\n      if (particle.element.style.display === \"none\") {\r\n        particle.element.style.display = \"\";\r\n      }\r\n      const pathing = this.options.pathing === \"bezierQuad\"\r\n        ? Avoidance.animate.paths.bezierQuad(particleOldPosRatio, particle.originalPosRatio, particleNewPosRatio)\r\n        : Avoidance.animate.paths.linear(particleOldPosRatio, particleNewPosRatio);\r\n      Avoidance.animate.move(particle.element, pathing, 1000, this.options.timing);\r\n    }\r\n  }\r\n\r\n  calculateAvoidanceFactor(originalDistance, elementSize, method) {\r\n    if (method === undefined) {\r\n      method = this.options.factorMethod.name;\r\n    }\r\n    var methodFn = null;\r\n    if (method !== undefined) {\r\n      methodFn = Avoidance.calculateAvoidanceFactor.builtinMethods[method];\r\n    }\r\n    else {\r\n      methodFn = Avoidance.calculateAvoidanceFactor.builtinMethods.powerInverse;\r\n    }\r\n    return methodFn(\r\n      this.options.factorMethod.scale,\r\n      this.options.factorMethod.offset,\r\n      this.options.factorMethod.power\r\n    )(originalDistance, elementSize);\r\n  }\r\n  \r\n  calculateAvoidanceDisplacement(particleOrigPosRelMouse, avoidanceFactor, method) {\r\n    if (method === undefined) {\r\n      method = this.options.displacementMethod.name;\r\n    }\r\n    var methodFn = null;\r\n    if (method !== undefined) {\r\n      methodFn = Avoidance.calculateAvoidanceDisplacement.builtinMethods[method];\r\n    }\r\n    else {\r\n      methodFn = Avoidance.calculateAvoidanceDisplacement.builtinMethods.threshold;\r\n    }\r\n    return methodFn(\r\n      this.options.displacementMethod.thresholdRadius\r\n    )(particleOrigPosRelMouse, avoidanceFactor);\r\n  }\r\n}\r\n\r\nAvoidance.geometry = {\r\n  getDistance: function(pointA, pointB) {\r\n    return Math.sqrt(Math.pow(pointA.x - pointB.x, 2) + Math.pow(pointA.y - pointB.y, 2));\r\n  },\r\n  getRadius: function(point) {\r\n    return Math.sqrt(point.x*point.x + point.y*point.y);\r\n  },\r\n  getUnitVector: function(point) {\r\n    const radius = Avoidance.geometry.getRadius(point);\r\n    return {\r\n      x: point.x / radius,\r\n      y: point.y / radius,\r\n    };\r\n  }\r\n}\r\n\r\nAvoidance.calculateAvoidanceFactor = {\r\n  builtinMethods: {\r\n    inverse: function(param_scale=0.02, param_offset=0.0, param_power=undefined) {\r\n      return function(originalDistance, elementSize) {\r\n        if (originalDistance === 0) {\r\n          return NaN;\r\n        }\r\n        else {\r\n          return (param_scale*1.0)/originalDistance + param_offset;\r\n        }\r\n      }\r\n    },\r\n    exponential: function(param_scale=0.1, param_offset=0.0, param_power=undefined) {\r\n      return function(originalDistance, elementSize) {\r\n        return Math.exp(param_scale-originalDistance) + param_offset;\r\n      }\r\n    },\r\n    powerInverse: function(param_scale=0.02, param_offset=0.0, param_power=0.6) {\r\n      return function(originalDistance, elementSize) {\r\n        if (originalDistance === 0) {\r\n          return NaN;\r\n        }\r\n        else {\r\n          return ((param_scale*1.0)/Math.pow(originalDistance*1.0, param_power) + param_offset);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nAvoidance.calculateAvoidanceDisplacement = {\r\n  builtinMethods: {\r\n    threshold: function(param_threshold_radius=0.1) {\r\n      return function(directionUnitVector, avoidanceFactor) {\r\n        if (avoidanceFactor === NaN) {\r\n          return null;\r\n        }\r\n        var offset = {\r\n          x: directionUnitVector.x*avoidanceFactor,\r\n          y: directionUnitVector.y*avoidanceFactor,\r\n        };\r\n        if (Avoidance.geometry.getRadius(offset) > param_threshold_radius) {\r\n          return {\r\n            x: directionUnitVector.x*param_threshold_radius,\r\n            y: directionUnitVector.y*param_threshold_radius,\r\n          };\r\n        }\r\n        else {\r\n          return offset;\r\n        }\r\n      }\r\n    },\r\n    noThreshold: function(param_threshold_radius=undefined) {\r\n      return function(directionUnitVector, avoidanceFactor) {\r\n        if (avoidanceFactor === NaN) {\r\n          return null;\r\n        }\r\n        return {\r\n          x: directionUnitVector.x*avoidanceFactor,\r\n          y: directionUnitVector.y*avoidanceFactor,\r\n        };\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nAvoidance.math = {\r\n  toPctStr: function(x) {\r\n    return (100.0 * x) + \"%\";\r\n  }\r\n}\r\n\r\nAvoidance.animate = {\r\n  FRAME_DURATION: 10.0,\r\n  timings: {\r\n    linear: duration => t => t/duration,\r\n    easeOutCubic: duration => t => 1+Math.pow(t/duration-1, 3),\r\n    easeOutExpo: duration => t => 1-Math.pow(2, -10*t/duration),\r\n  },\r\n  paths: {\r\n    linear: function(p0, p1) {\r\n      return s => ({\r\n        x: p0.x + s*(p1.x - p0.x),\r\n        y: p0.y + s*(p1.y - p0.y),\r\n      });\r\n    },\r\n    bezierQuad: function(p0, p1, p2) {\r\n      return s => ({\r\n        x: p1.x + (1.0-s)*(1.0-s)*(p0.x-p1.x) + s*s*(p2.x-p1.x),\r\n        y: p1.y + (1.0-s)*(1.0-s)*(p0.y-p1.y) + s*s*(p2.y-p1.y),\r\n      }); // 0 <= s <= 1\r\n    },\r\n  },\r\n  move: function(element, pathing, duration, timing) {\r\n    var time = 0;\r\n    var distance = 0;\r\n    const distanceFromTime = timing(duration);\r\n    const animation = setInterval(() => {\r\n      // Check for final condition\r\n      if (time >= duration) {\r\n        clearInterval(animation);\r\n      }\r\n      // Calculate position\r\n      const pos = pathing(distance);\r\n      // Render\r\n      element.style.left = Avoidance.math.toPctStr(pos.x);\r\n      element.style.top = Avoidance.math.toPctStr(pos.y);\r\n      // Update vars for next iteration\r\n      time = time + this.FRAME_DURATION;\r\n      distance = distanceFromTime(time);\r\n    }, this.FRAME_DURATION);\r\n  },\r\n}\r\n\r\nAvoidance.Particle = class {\r\n  constructor(element, container) {\r\n    // Save both elements\r\n    this.element = element;\r\n    this.container = container;\r\n    this.originalPosRatio = this.getPosRatio();\r\n  }\r\n  getPosRatio() {\r\n    // Get position as percentage of container to get built-in responsiveness!\r\n    const elementRect = this.element.getBoundingClientRect();\r\n    const containerRect = this.container.getBoundingClientRect();\r\n    return {\r\n      x: (elementRect.left - containerRect.left) / containerRect.width,\r\n      y: (elementRect.top - containerRect.top) / containerRect.height,\r\n    };\r\n  }\r\n  getSizeRatio() {\r\n    // Get size as percentage of container to get built-in responsiveness!\r\n    const elementRect = this.element.getBoundingClientRect();\r\n    const containerRect = this.container.getBoundingClientRect();\r\n    return {\r\n      width: elementRect.width / containerRect.width,\r\n      height: elementRect.height / containerRect.height,\r\n    };\r\n  }\r\n  dispose() {\r\n    // TODO: return particle to original location, either by setting style or removing location style\r\n  }\r\n}"],"names":["Avoidance","containerSelector","options","addChildrenAsParticles","containersCollection","document","querySelectorAll","containers","Array","prototype","slice","call","this","initOptions","trackedParticles","trackedParticleElementsSet","Set","mouseMoveHandler","bind","clickHandler","touchStartHandler","touchEndHandler","forEach","container","i","children","length","startTrackingParticleElement","status","userOptions","factorMethod","calculateAvoidanceFactor","builtinMethods","name","scale","undefined","offset","power","_typeof","displacementMethod","calculateAvoidanceDisplacement","thresholdRadius","timing","animate","timings","easeOutExpo","pathing","paths","particleSelector","particleElement","_this","querySelector","containerElement","stopTrackingParticleElements","stopTrackingParticleElement","has","body","particle","Particle","push","add","foundIdx","findIndex","element","dispose","splice","particleElements","particleElementSet","filter","registerEventHandlers","deregisterEventHandlers","indexOf","removeChildrenAsParticles","idx","addEventListener","removeEventListener","event","touchStarted","touchEnded","preventDefault","currentTarget","mousePos","x","pageX","offsetLeft","y","pageY","offsetTop","computeAvoidance","renderImmediateAvoidance","touchPos","renderAnimatedAvoidance","userPos","renderCallback","containerRect","getBoundingClientRect","userPosRatio","width","height","particleSizeRatio","getSizeRatio","particleCentreOrigPosRatioRelUser","originalPosRatio","particleCentreOrigDistRelUser","geometry","getRadius","avoidanceFactor","avoidanceDisplacement","getUnitVector","style","display","particleNewPos","left","math","toPctStr","top","particleOldPosRatio","getPosRatio","particleNewPosRatio","bezierQuad","linear","move","originalDistance","elementSize","method","powerInverse","methodFn","particleOrigPosRelMouse","threshold","getDistance","pointA","pointB","Math","sqrt","pow","point","radius","inverse","param_scale","param_offset","NaN","exponential","exp","param_power","param_threshold_radius","directionUnitVector","noThreshold","FRAME_DURATION","duration","t","easeOutCubic","p0","p1","s","p2","time","distance","distanceFromTime","animation","setInterval","clearInterval","pos","_this2","elementRect"],"mappings":"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"}