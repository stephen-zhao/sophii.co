!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Avoidance=t():e.Avoidance=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.r(t),n.d(t,"default",(function(){return c}));var c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];o(this,e);var r=document.querySelectorAll(t);this.containers=Array.prototype.slice.call(r),this.options=this.initOptions(n),this.trackedParticles=[],this.trackedParticleElementsSet=new Set,this.mouseMoveHandler=this.mouseMoveHandler.bind(this),this.clickHandler=this.clickHandler.bind(this),this.touchStartHandler=this.touchStartHandler.bind(this),this.touchEndHandler=this.touchEndHandler.bind(this),i&&this.containers.forEach((function(e){for(var t=0;t<e.children.length;++t)this.startTrackingParticleElement(e.children[t])}),this),this.status="ready"}return a(e,[{key:"initOptions",value:function(t){var n={factorMethod:{}};return"factorMethod"in t&&("string"==typeof t.factorMethod&&t.factorMethod in e.calculateAvoidanceFactor.builtinMethods?(n.factorMethod.name=t.factorMethod,n.factorMethod.scale=void 0,n.factorMethod.offset=void 0,n.factorMethod.power=void 0):"object"===i(t.factorMethod)?("name"in t.factorMethod&&"string"==typeof t.factorMethod.name&&t.factorMethod.name in e.calculateAvoidanceFactor.builtinMethods?n.factorMethod.name=t.factorMethod.name:n.factorMethod.name=void 0,"scale"in t.factorMethod&&"number"==typeof t.factorMethod.scale?n.factorMethod.scale=t.factorMethod.scale:n.factorMethod.scale=void 0,"offset"in t.factorMethod&&"number"==typeof t.factorMethod.offset?n.factorMethod.offset=t.factorMethod.offset:n.factorMethod.offset=void 0,"power"in t.factorMethod&&"number"==typeof t.factorMethod.power?n.factorMethod.power=t.factorMethod.power:n.factorMethod.power=void 0):(n.factorMethod.name=void 0,n.factorMethod.scale=void 0,n.factorMethod.offset=void 0,n.factorMethod.power=void 0)),n.displacementMethod={},"displacementMethod"in t&&("string"==typeof t.displacementMethod&&t.displacementMethod in e.calculateAvoidanceDisplacement.builtinMethods?(n.displacementMethod.name=t.displacementMethod,n.displacementMethod.thresholdRadius=void 0):"object"===i(t.displacementMethod)?("name"in t.displacementMethod&&"string"==typeof t.displacementMethod.name&&t.displacementMethod.name in e.calculateAvoidanceDisplacement.builtinMethods?n.displacementMethod.name=t.displacementMethod.name:n.displacementMethod.name=void 0,"thresholdRadius"in t.displacementMethod&&"number"==typeof t.displacementMethod.thresholdRadius?n.displacementMethod.thresholdRadius=t.displacementMethod.thresholdRadius:n.displacementMethod.thresholdRadius=void 0):(n.displacementMethod.name=void 0,n.displacementMethod.thresholdRadius=void 0)),"timing"in t&&"string"==typeof t.timing&&t.timing in e.animate.timings?n.timing=e.animate.timings[t.timing]:n.timing=e.animate.timings.easeOutExpo,"pathing"in t&&"string"==typeof t.pathing&&t.pathing in e.animate.paths?n.pathing=t.pathing:n.pathing="bezierQuad",n}},{key:"addParticles",value:function(e){document.querySelectorAll(e).forEach(this.startTrackingParticleElement,this)}},{key:"addParticleElement",value:function(e){this.startTrackingParticleElement(e)}},{key:"removeParticles",value:function(e){this.stopTrackingParticleElements(document.querySelectorAll(e))}},{key:"removeParticleElement",value:function(e){this.stopTrackingParticleElement(e)}},{key:"startTrackingParticleElement",value:function(t){if(!this.trackedParticleElementsSet.has(t)){var n=new e.Particle(t);this.trackedParticles.push(n),this.trackedParticleElementsSet.add(t)}}},{key:"stopTrackingParticleElement",value:function(e){if(this.trackedParticleElementsSet.has(e)){this.trackedParticleElementsSet.delete(e);var t=this.trackedParticles.findIndex((function(t){return t.element===e}));-1!==t&&(this.trackedParticles[t].dispose(),this.trackedParticles.splice(t,1))}}},{key:"stopTrackingParticleElements",value:function(e){for(var t=new Set(e),n=0;n<this.trackedParticles.length;++n)t.has(this.trackedParticles[n].element)&&(this.trackedParticleElementsSet.delete(this.trackedParticles[n].element),this.trackedParticles[n].dispose(),this.trackedParticles[n]="removed");this.trackedParticles=this.trackedParticles.filter((function(e){return"removed"!==e}))}},{key:"start",value:function(){this.containers.forEach(this.registerEventHandlers,this),this.status="running"}},{key:"stop",value:function(){this.containers.forEach(this.deregisterEventHandlers,this),this.status="stopped"}},{key:"addContainers",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.querySelectorAll(e);n.forEach((function(e){if(!(this.containers.indexOf(e)>=0)){if(this.containers.push(e),t)for(var n=0;n<e.children.length;++n)this.startTrackingParticleElement(e.children[n]);"running"===this.status&&this.registerEventHandlers(e)}}),this)}},{key:"removeContainers",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.querySelectorAll(e);n.forEach((function(e){var n=this.containers.indexOf(e);n<0||(t&&this.stopTrackingParticleElements(e.children),"running"===this.status&&this.deregisterEventHandlers(e),this.containers.splice(n,1))}),this)}},{key:"registerEventHandlers",value:function(e){e.addEventListener("touchend",this.touchEndHandler),e.addEventListener("touchstart",this.touchStartHandler),e.addEventListener("mousemove",this.mouseMoveHandler),e.addEventListener("click",this.clickHandler)}},{key:"deregisterEventHandlers",value:function(e){e.removeEventListener("click",this.clickHandler),e.removeEventListener("mousemove",this.mouseMoveHandler),e.removeEventListener("touchstart",this.touchStartHandler),e.removeEventListener("touchend",this.touchEndHandler)}},{key:"mouseMoveHandler",value:function(e){if(this.touchStarted||this.touchEnded)e.preventDefault();else{var t=e.currentTarget,n={x:e.pageX-t.offsetLeft,y:e.pageY-t.offsetTop};this.computeAvoidance(t,n,this.renderImmediateAvoidance.bind(this))}}},{key:"clickHandler",value:function(e){if(this.touchStarted||this.touchEnded){var t=e.currentTarget,n={x:e.pageX-t.offsetLeft,y:e.pageY-t.offsetTop};this.computeAvoidance(t,n,this.renderAnimatedAvoidance.bind(this)),this.touchStarted=!1,this.touchEnded=!1}}},{key:"touchStartHandler",value:function(e){this.touchStarted=!0}},{key:"touchEndHandler",value:function(e){this.touchEnded=!0}},{key:"computeAvoidance",value:function(t,n,i){var o=e.geometry.getRadius({x:t.offsetWidth,y:t.offsetHeight});this.trackedParticles.forEach((function(t){var r={width:t.element.offsetWidth,height:t.element.offsetHeight},a={x:t.originalPos.x+1*r.width/2-n.x,y:t.originalPos.y+1*r.height/2-n.y},c=e.geometry.getRadius(a),s=this.calculateAvoidanceFactor(c,r,o),l=this.calculateAvoidanceDisplacement(a,s);i(l,t)}),this)}},{key:"renderImmediateAvoidance",value:function(e,t){if(null===e)t.element.style.display="none";else{var n={x:t.originalPos.x+e.x,y:t.originalPos.y+e.y};"none"===t.element.style.display&&(t.element.style.display=""),t.element.style.left=n.x,t.element.style.top=n.y}}},{key:"renderAnimatedAvoidance",value:function(t,n){if(null===t)n.element.style.display="none";else{var i={x:n.element.offsetLeft,y:n.element.offsetTop},o={x:n.originalPos.x+t.x,y:n.originalPos.y+t.y};"none"===n.element.style.display&&(n.element.style.display="");var r="bezierQuad"===this.options.pathing?e.animate.paths.bezierQuad(i,n.originalPos,o):e.animate.paths.linear(i,o);e.animate.move(n.element,r,1e3,this.options.timing)}}},{key:"calculateAvoidanceFactor",value:function(t,n,i,o){void 0===o&&(o=this.options.factorMethod.name);return(void 0!==o?e.calculateAvoidanceFactor.builtinMethods[o]:e.calculateAvoidanceFactor.builtinMethods.power_inverse)(this.options.factorMethod.scale,this.options.factorMethod.offset,this.options.factorMethod.power)(t,n,i)}},{key:"calculateAvoidanceDisplacement",value:function(t,n,i){void 0===i&&(i=this.options.displacementMethod.name);return(void 0!==i?e.calculateAvoidanceDisplacement.builtinMethods[i]:e.calculateAvoidanceDisplacement.builtinMethods.absolute_threshold)(this.options.displacementMethod.thresholdRadius)(t,n)}}]),e}();c.geometry={getDistance:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},getRadius:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)}},c.calculateAvoidanceFactor={builtinMethods:{inverse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(n,i,o){return 0===n?NaN:o*e*1/n+t}},exponential:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25;return function(n,i,o){return Math.exp(e-1*n/o)+t}},power_inverse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1.6;return function(i,o,r){return 0===i?NaN:r*e*1/Math.pow(1*i,n)+t}}}},c.calculateAvoidanceDisplacement={builtinMethods:{absolute_threshold:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:80;return function(t,n){if(NaN===n)return null;var i={x:t.x*n,y:t.y*n};if(c.geometry.getRadius(i)>e){var o=c.geometry.getRadius(t),r=e/o;return{x:t.x*r,y:t.y*r}}return i}},proportional_threshold:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return function(t,n){if(NaN===n)return null;var i={x:t.x*n,y:t.y*n};return n>e?{x:t.x*e,y:t.y*e}:i}},standard:function(){return function(e,t){return NaN===t?null:{x:e.x*t,y:e.y*t}}}}},c.dom={pageOffset:function(e){var t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{x:t.left+n,y:t.top+i}},getCentre:function(e,t){return{x:e.offsetLeft+e.offsetWidth/2-(t?t.offsetLeft:0),y:e.offsetTop+e.offsetHeight/2-(t?t.offsetTop:0)}}},c.animate={FRAME_DURATION:10,timings:{linear:function(e){return function(t){return t/e}},easeOutCubic:function(e){return function(t){return 1+Math.pow(t/e-1,3)}},easeOutExpo:function(e){return function(t){return 1-Math.pow(2,-10*t/e)}}},paths:{linear:function(e,t){return function(n){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}},bezierQuad:function(e,t,n){return function(i){return{x:t.x+(1-i)*(1-i)*(e.x-t.x)+i*i*(n.x-t.x),y:t.y+(1-i)*(1-i)*(e.y-t.y)+i*i*(n.y-t.y)}}}},move:function(e,t,n,i){var o=this,r=0,a=0,c=i(n),s=setInterval((function(){r>=n&&clearInterval(s);var i=t(a);e.style.left=i.x,e.style.top=i.y,r+=o.FRAME_DURATION,a=c(r)}),this.FRAME_DURATION)}},c.Particle=function(){function e(t){o(this,e),this.element=t,this.originalPos={x:t.offsetLeft,y:t.offsetTop}}return a(e,[{key:"dispose",value:function(){}}]),e}()}]).default}));
//# sourceMappingURL=avoidance.umd.min.js.map