!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Avoidance=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var o=function(){function n(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e(this,n);var a=document.querySelectorAll(t);this.containers=Array.prototype.slice.call(a),this.options=this.initOptions(i),this.trackedParticles=[],this.trackedParticleElementsSet=new Set,this.mouseMoveHandler=this.mouseMoveHandler.bind(this),this.clickHandler=this.clickHandler.bind(this),this.touchStartHandler=this.touchStartHandler.bind(this),this.touchEndHandler=this.touchEndHandler.bind(this),o&&this.containers.forEach((function(t){for(var e=0;e<t.children.length;++e)this.startTrackingParticleElement(t.children[e],t)}),this),this.status="ready"}return i(n,[{key:"initOptions",value:function(e){var i={factorMethod:{}};return"factorMethod"in e&&("string"==typeof e.factorMethod&&e.factorMethod in n.calculateAvoidanceFactor.builtinMethods?(i.factorMethod.name=e.factorMethod,i.factorMethod.scale=void 0,i.factorMethod.offset=void 0,i.factorMethod.power=void 0):"object"===t(e.factorMethod)?("name"in e.factorMethod&&"string"==typeof e.factorMethod.name&&e.factorMethod.name in n.calculateAvoidanceFactor.builtinMethods?i.factorMethod.name=e.factorMethod.name:i.factorMethod.name=void 0,"scale"in e.factorMethod&&"number"==typeof e.factorMethod.scale?i.factorMethod.scale=e.factorMethod.scale:i.factorMethod.scale=void 0,"offset"in e.factorMethod&&"number"==typeof e.factorMethod.offset?i.factorMethod.offset=e.factorMethod.offset:i.factorMethod.offset=void 0,"power"in e.factorMethod&&"number"==typeof e.factorMethod.power?i.factorMethod.power=e.factorMethod.power:i.factorMethod.power=void 0):(i.factorMethod.name=void 0,i.factorMethod.scale=void 0,i.factorMethod.offset=void 0,i.factorMethod.power=void 0)),i.displacementMethod={},"displacementMethod"in e&&("string"==typeof e.displacementMethod&&e.displacementMethod in n.calculateAvoidanceDisplacement.builtinMethods?(i.displacementMethod.name=e.displacementMethod,i.displacementMethod.thresholdRadius=void 0):"object"===t(e.displacementMethod)?("name"in e.displacementMethod&&"string"==typeof e.displacementMethod.name&&e.displacementMethod.name in n.calculateAvoidanceDisplacement.builtinMethods?i.displacementMethod.name=e.displacementMethod.name:i.displacementMethod.name=void 0,"thresholdRadius"in e.displacementMethod&&"number"==typeof e.displacementMethod.thresholdRadius?i.displacementMethod.thresholdRadius=e.displacementMethod.thresholdRadius:i.displacementMethod.thresholdRadius=void 0):(i.displacementMethod.name=void 0,i.displacementMethod.thresholdRadius=void 0)),"timing"in e&&"string"==typeof e.timing&&e.timing in n.animate.timings?i.timing=n.animate.timings[e.timing]:i.timing=n.animate.timings.easeOutExpo,"pathing"in e&&"string"==typeof e.pathing&&e.pathing in n.animate.paths?i.pathing=e.pathing:i.pathing="bezierQuad",i}},{key:"addParticles",value:function(t,e){var n=this;document.querySelectorAll(t).forEach((function(t){n.startTrackingParticleElement(t,e?document.querySelector(e):void 0)}),this)}},{key:"addParticleElement",value:function(t,e){this.startTrackingParticleElement(t,e)}},{key:"removeParticles",value:function(t){this.stopTrackingParticleElements(document.querySelectorAll(t))}},{key:"removeParticleElement",value:function(t){this.stopTrackingParticleElement(t)}},{key:"startTrackingParticleElement",value:function(t,e){if(!this.trackedParticleElementsSet.has(t)){e||(e=document.body);var i=new n.Particle(t,e);this.trackedParticles.push(i),this.trackedParticleElementsSet.add(t)}}},{key:"stopTrackingParticleElement",value:function(t){if(this.trackedParticleElementsSet.has(t)){this.trackedParticleElementsSet.delete(t);var e=this.trackedParticles.findIndex((function(e){return e.element===t}));-1!==e&&(this.trackedParticles[e].dispose(),this.trackedParticles.splice(e,1))}}},{key:"stopTrackingParticleElements",value:function(t){for(var e=new Set(t),n=0;n<this.trackedParticles.length;++n)e.has(this.trackedParticles[n].element)&&(this.trackedParticleElementsSet.delete(this.trackedParticles[n].element),this.trackedParticles[n].dispose(),this.trackedParticles[n]="removed");this.trackedParticles=this.trackedParticles.filter((function(t){return"removed"!==t}))}},{key:"start",value:function(){this.containers.forEach(this.registerEventHandlers,this),this.trackedParticles.forEach((function(t){t.unfreeze()})),this.status="running"}},{key:"stop",value:function(){this.trackedParticles.forEach((function(t){t.freeze()})),this.containers.forEach(this.deregisterEventHandlers,this),this.status="stopped"}},{key:"addContainers",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.querySelectorAll(t);n.forEach((function(t){if(!(this.containers.indexOf(t)>=0)){if(this.containers.push(t),e)for(var n=0;n<t.children.length;++n)this.startTrackingParticleElement(t.children[n]);"running"===this.status&&this.registerEventHandlers(t)}}),this)}},{key:"removeContainers",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.querySelectorAll(t);n.forEach((function(t){var n=this.containers.indexOf(t);n<0||(e&&this.stopTrackingParticleElements(t.children),"running"===this.status&&this.deregisterEventHandlers(t),this.containers.splice(n,1))}),this)}},{key:"registerEventHandlers",value:function(t){t.addEventListener("touchend",this.touchEndHandler),t.addEventListener("touchstart",this.touchStartHandler),t.addEventListener("mousemove",this.mouseMoveHandler),t.addEventListener("click",this.clickHandler)}},{key:"deregisterEventHandlers",value:function(t){t.removeEventListener("click",this.clickHandler),t.removeEventListener("mousemove",this.mouseMoveHandler),t.removeEventListener("touchstart",this.touchStartHandler),t.removeEventListener("touchend",this.touchEndHandler)}},{key:"mouseMoveHandler",value:function(t){if(this.touchStarted||this.touchEnded)t.preventDefault();else{var e=t.currentTarget,n={x:t.pageX-e.offsetLeft,y:t.pageY-e.offsetTop};this.computeAvoidance(e,n,this.renderImmediateAvoidance.bind(this))}}},{key:"clickHandler",value:function(t){if(this.touchStarted||this.touchEnded){var e=t.currentTarget,n={x:t.pageX-e.offsetLeft,y:t.pageY-e.offsetTop};this.computeAvoidance(e,n,this.renderAnimatedAvoidance.bind(this)),this.touchStarted=!1,this.touchEnded=!1}}},{key:"touchStartHandler",value:function(t){this.touchStarted=!0}},{key:"touchEndHandler",value:function(t){this.touchEnded=!0}},{key:"computeAvoidance",value:function(t,e,i){var o=t.getBoundingClientRect(),a=e.x/o.width,r=e.y/o.height;this.trackedParticles.forEach((function(t){var e=t.getSizeRatio(),o={x:t.originalPosRatio.x+1*e.width/2-a,y:t.originalPosRatio.y+1*e.height/2-r},s=n.geometry.getRadius(o),c=this.calculateAvoidanceFactor(s,e),l=this.calculateAvoidanceDisplacement(n.geometry.getUnitVector(o),c);i(l,t)}),this)}},{key:"renderImmediateAvoidance",value:function(t,e){if(null===t)e.element.style.display="none";else{var i={x:e.originalPosRatio.x+t.x,y:e.originalPosRatio.y+t.y};"none"===e.element.style.display&&(e.element.style.display=""),e.element.style.left=n.math.toPctStr(i.x),e.element.style.top=n.math.toPctStr(i.y)}}},{key:"renderAnimatedAvoidance",value:function(t,e){if(null===t)e.element.style.display="none";else{var i=e.getPosRatio(),o={x:e.originalPosRatio.x+t.x,y:e.originalPosRatio.y+t.y};"none"===e.element.style.display&&(e.element.style.display="");var a="bezierQuad"===this.options.pathing?n.animate.paths.bezierQuad(i,e.originalPosRatio,o):n.animate.paths.linear(i,o);n.animate.move(e.element,a,1e3,this.options.timing)}}},{key:"calculateAvoidanceFactor",value:function(t,e,i){void 0===i&&(i=this.options.factorMethod.name);return(void 0!==i?n.calculateAvoidanceFactor.builtinMethods[i]:n.calculateAvoidanceFactor.builtinMethods.powerInverse)(this.options.factorMethod.scale,this.options.factorMethod.offset,this.options.factorMethod.power)(t,e)}},{key:"calculateAvoidanceDisplacement",value:function(t,e,i){void 0===i&&(i=this.options.displacementMethod.name);return(void 0!==i?n.calculateAvoidanceDisplacement.builtinMethods[i]:n.calculateAvoidanceDisplacement.builtinMethods.threshold)(this.options.displacementMethod.thresholdRadius)(t,e)}}]),n}();return o.geometry={getDistance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},getRadius:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},getUnitVector:function(t){var e=o.geometry.getRadius(t);return{x:t.x/e,y:t.y/e}}},o.calculateAvoidanceFactor={builtinMethods:{inverse:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.02,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(n,i){return 0===n?NaN:1*t/n+e}},exponential:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(n,i){return Math.exp(t-n)+e}},powerInverse:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.02,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6;return function(i,o){return 0===i?NaN:1*t/Math.pow(1*i,n)+e}}}},o.calculateAvoidanceDisplacement={builtinMethods:{threshold:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return function(e,n){if(NaN===n)return null;var i={x:e.x*n,y:e.y*n};return o.geometry.getRadius(i)>t?{x:e.x*t,y:e.y*t}:i}},noThreshold:function(){return function(t,e){return NaN===e?null:{x:t.x*e,y:t.y*e}}}}},o.math={toPctStr:function(t){return 100*t+"%"}},o.animate={FRAME_DURATION:10,timings:{linear:function(t){return function(e){return e/t}},easeOutCubic:function(t){return function(e){return 1+Math.pow(e/t-1,3)}},easeOutExpo:function(t){return function(e){return 1-Math.pow(2,-10*e/t)}}},paths:{linear:function(t,e){return function(n){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}},bezierQuad:function(t,e,n){return function(i){return{x:e.x+(1-i)*(1-i)*(t.x-e.x)+i*i*(n.x-e.x),y:e.y+(1-i)*(1-i)*(t.y-e.y)+i*i*(n.y-e.y)}}}},move:function(t,e,n,i){var a=this,r=0,s=0,c=i(n),l=setInterval((function(){r>=n&&clearInterval(l);var i=e(s);t.style.left=o.math.toPctStr(i.x),t.style.top=o.math.toPctStr(i.y),r+=a.FRAME_DURATION,s=c(r)}),this.FRAME_DURATION)}},o.Particle=function(){function t(n,i){e(this,t),this.element=n,this.container=i,this.originalPosRatio=this.getPosRatio()}return i(t,[{key:"getPosRatio",value:function(){var t=this.element.getBoundingClientRect(),e=this.container.getBoundingClientRect();return{x:(t.left-e.left)/e.width,y:(t.top-e.top)/e.height}}},{key:"getSizeRatio",value:function(){var t=this.element.getBoundingClientRect(),e=this.container.getBoundingClientRect();return{width:t.width/e.width,height:t.height/e.height}}},{key:"dispose",value:function(){}},{key:"unfreeze",value:function(){var t=this;this.frozenStyledPosition=this.element.style.position;var e=function(){t.element.style.position="absolute",t.container.removeEventListener("mousemove",e)}.bind(this);this.container.addEventListener("mousemove",e)}},{key:"freeze",value:function(){this.element.style.position=this.element.style.position}}]),t}(),o}));
//# sourceMappingURL=avoidance.min.js.map
