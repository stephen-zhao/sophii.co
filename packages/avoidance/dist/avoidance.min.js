!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Avoidance=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=function(){function e(n,i){t(this,e),o(this,"_element",void 0),o(this,"_container",void 0),o(this,"_originalPosRatio",void 0),o(this,"_frozenStyledPosition",void 0),this._element=n,this._container=i,this._originalPosRatio=this.getPosRatio()}return i(e,[{key:"dispose",value:function(){}},{key:"getPosRatio",value:function(){var e=this.element.getBoundingClientRect(),t=this.container.getBoundingClientRect();return{x:(e.left-t.left)/t.width,y:(e.top-t.top)/t.height}}},{key:"getSizeRatio",value:function(){var e=this.element.getBoundingClientRect(),t=this.container.getBoundingClientRect();return{width:e.width/t.width,height:e.height/t.height}}},{key:"unfreeze",value:function(){var e=this;this._frozenStyledPosition=this.element.style.position;var t=function(){e.element.style.position="absolute",e.container.removeEventListener("mousemove",t)}.bind(this);this.container.addEventListener("mousemove",t)}},{key:"freeze",value:function(){this.element.style.position=this.element.style.position}},{key:"originalPosRatio",get:function(){return this._originalPosRatio}},{key:"element",get:function(){return this._element}},{key:"container",get:function(){return this._container}}]),e}();function c(e){return 100*e+"%"}var l,d={linear:function(e){return function(t){return t/e}},easeOutCubic:function(e){return function(t){return 1+Math.pow(t/e-1,3)}},easeOutExpo:function(e){return function(t){return 1-Math.pow(2,-10*t/e)}}},h={linear:function(e){var t=r(e,2),n=t[0],i=t[1];return function(e){return{x:n.x+e*(i.x-n.x),y:n.y+e*(i.y-n.y)}}},bezierQuad:function(e){var t=r(e,3),n=t[0],i=t[1],o=t[2];return function(e){return{x:i.x+(1-e)*(1-e)*(n.x-i.x)+e*e*(o.x-i.x),y:i.y+(1-e)*(1-e)*(n.y-i.y)+e*e*(o.y-i.y)}}}};function u(e){return Math.sqrt(e.x*e.x+e.y*e.y)}!function(e){e.inverse="inverse",e.exponential="exponential",e.powerInverse="powerInverse"}(l||(l={}));var f,v={inverse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.02,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(n,i){return 0===n?NaN:1*e/n+t}},exponential:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(n,i){return Math.exp(e-n)+t}},powerInverse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.02,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6;return function(i,o){return 0===i?NaN:1*e/Math.pow(1*i,n)+t}}};!function(e){e.threshold="threshold",e.noThreshold="noThreshold"}(f||(f={}));var m={threshold:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return function(t,n){if(NaN===n)return null;var i={x:t.x*n,y:t.y*n};return u(i)>e?{x:t.x*e,y:t.y*e}:i}},noThreshold:function(){return function(e,t){return NaN===t?null:{x:e.x*t,y:e.y*t}}}};return function(){function n(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t(this,n);var r=document.querySelectorAll(e);this.containers=Array.prototype.slice.call(r),this.options=this.initOptions(i),this.trackedParticles=[],this.trackedParticleElementsSet=new Set,this.mouseMoveHandler=this.mouseMoveHandler.bind(this),this.clickHandler=this.clickHandler.bind(this),this.touchStartHandler=this.touchStartHandler.bind(this),this.touchEndHandler=this.touchEndHandler.bind(this),o&&this.containers.forEach((function(e){for(var t=0;t<e.children.length;++t)this.startTrackingParticleElement(e.children[t],e)}),this),this.status="ready"}return i(n,[{key:"initOptions",value:function(t){var n={factorMethod:{}};return"factorMethod"in t&&("string"==typeof t.factorMethod&&t.factorMethod in v?(n.factorMethod.name=t.factorMethod,n.factorMethod.scale=void 0,n.factorMethod.offset=void 0,n.factorMethod.power=void 0):"object"===e(t.factorMethod)?("name"in t.factorMethod&&"string"==typeof t.factorMethod.name&&t.factorMethod.name in v?n.factorMethod.name=t.factorMethod.name:n.factorMethod.name=void 0,"scale"in t.factorMethod&&"number"==typeof t.factorMethod.scale?n.factorMethod.scale=t.factorMethod.scale:n.factorMethod.scale=void 0,"offset"in t.factorMethod&&"number"==typeof t.factorMethod.offset?n.factorMethod.offset=t.factorMethod.offset:n.factorMethod.offset=void 0,"power"in t.factorMethod&&"number"==typeof t.factorMethod.power?n.factorMethod.power=t.factorMethod.power:n.factorMethod.power=void 0):(n.factorMethod.name=void 0,n.factorMethod.scale=void 0,n.factorMethod.offset=void 0,n.factorMethod.power=void 0)),n.displacementMethod={},"displacementMethod"in t&&("string"==typeof t.displacementMethod&&t.displacementMethod in m?(n.displacementMethod.name=t.displacementMethod,n.displacementMethod.thresholdRadius=void 0):"object"===e(t.displacementMethod)?("name"in t.displacementMethod&&"string"==typeof t.displacementMethod.name&&t.displacementMethod.name in m?n.displacementMethod.name=t.displacementMethod.name:n.displacementMethod.name=void 0,"thresholdRadius"in t.displacementMethod&&"number"==typeof t.displacementMethod.thresholdRadius?n.displacementMethod.thresholdRadius=t.displacementMethod.thresholdRadius:n.displacementMethod.thresholdRadius=void 0):(n.displacementMethod.name=void 0,n.displacementMethod.thresholdRadius=void 0)),"timing"in t&&"string"==typeof t.timing&&t.timing in d?n.timing=d[t.timing]:n.timing=d.easeOutExpo,"pathing"in t&&"string"==typeof t.pathing&&t.pathing in h?n.pathing=t.pathing:n.pathing="bezierQuad",n}},{key:"addParticles",value:function(e,t){var n=this;document.querySelectorAll(e).forEach((function(e){n.startTrackingParticleElement(e,t?document.querySelector(t):void 0)}),this)}},{key:"addParticleElement",value:function(e,t){this.startTrackingParticleElement(e,t)}},{key:"removeParticles",value:function(e){this.stopTrackingParticleElements(document.querySelectorAll(e))}},{key:"removeParticleElement",value:function(e){this.stopTrackingParticleElement(e)}},{key:"startTrackingParticleElement",value:function(e,t){if(!this.trackedParticleElementsSet.has(e)){t||(t=document.body);var n=new s(e,t);this.trackedParticles.push(n),this.trackedParticleElementsSet.add(e)}}},{key:"stopTrackingParticleElement",value:function(e){if(this.trackedParticleElementsSet.has(e)){this.trackedParticleElementsSet.delete(e);var t=this.trackedParticles.findIndex((function(t){return t.element===e}));-1!==t&&(this.trackedParticles[t].dispose(),this.trackedParticles.splice(t,1))}}},{key:"stopTrackingParticleElements",value:function(e){for(var t=new Set(e),n=0;n<this.trackedParticles.length;++n)t.has(this.trackedParticles[n].element)&&(this.trackedParticleElementsSet.delete(this.trackedParticles[n].element),this.trackedParticles[n].dispose(),this.trackedParticles[n]="removed");this.trackedParticles=this.trackedParticles.filter((function(e){return"removed"!==e}))}},{key:"start",value:function(){this.containers.forEach(this.registerEventHandlers,this),this.trackedParticles.forEach((function(e){e.unfreeze()})),this.status="running"}},{key:"stop",value:function(){this.trackedParticles.forEach((function(e){e.freeze()})),this.containers.forEach(this.deregisterEventHandlers,this),this.status="stopped"}},{key:"addContainers",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.querySelectorAll(e);n.forEach((function(e){if(!(this.containers.indexOf(e)>=0)){if(this.containers.push(e),t)for(var n=0;n<e.children.length;++n)this.startTrackingParticleElement(e.children[n]);"running"===this.status&&this.registerEventHandlers(e)}}),this)}},{key:"removeContainers",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.querySelectorAll(e);n.forEach((function(e){var n=this.containers.indexOf(e);n<0||(t&&this.stopTrackingParticleElements(e.children),"running"===this.status&&this.deregisterEventHandlers(e),this.containers.splice(n,1))}),this)}},{key:"registerEventHandlers",value:function(e){e.addEventListener("touchend",this.touchEndHandler),e.addEventListener("touchstart",this.touchStartHandler),e.addEventListener("mousemove",this.mouseMoveHandler),e.addEventListener("click",this.clickHandler)}},{key:"deregisterEventHandlers",value:function(e){e.removeEventListener("click",this.clickHandler),e.removeEventListener("mousemove",this.mouseMoveHandler),e.removeEventListener("touchstart",this.touchStartHandler),e.removeEventListener("touchend",this.touchEndHandler)}},{key:"mouseMoveHandler",value:function(e){if(this.touchStarted||this.touchEnded)e.preventDefault();else{var t=e.currentTarget,n={x:e.pageX-t.offsetLeft,y:e.pageY-t.offsetTop};this.computeAvoidance(t,n,this.renderImmediateAvoidance.bind(this))}}},{key:"clickHandler",value:function(e){if(this.touchStarted||this.touchEnded){var t=e.currentTarget,n={x:e.pageX-t.offsetLeft,y:e.pageY-t.offsetTop};this.computeAvoidance(t,n,this.renderAnimatedAvoidance.bind(this)),this.touchStarted=!1,this.touchEnded=!1}}},{key:"touchStartHandler",value:function(e){this.touchStarted=!0}},{key:"touchEndHandler",value:function(e){this.touchEnded=!0}},{key:"computeAvoidance",value:function(e,t,n){var i=e.getBoundingClientRect(),o=t.x/i.width,r=t.y/i.height;this.trackedParticles.forEach((function(e){var t,i,a=e.getSizeRatio(),s={x:e.originalPosRatio.x+1*a.width/2-o,y:e.originalPosRatio.y+1*a.height/2-r},c=u(s),l=this.calculateAvoidanceFactor(c,a),d=this.calculateAvoidanceDisplacement((i=u(t=s),{x:t.x/i,y:t.y/i}),l);n(d,e)}),this)}},{key:"renderImmediateAvoidance",value:function(e,t){if(null===e)t.element.style.display="none";else{var n={x:t.originalPosRatio.x+e.x,y:t.originalPosRatio.y+e.y};"none"===t.element.style.display&&(t.element.style.display=""),t.element.style.left=c(n.x),t.element.style.top=c(n.y)}}},{key:"renderAnimatedAvoidance",value:function(e,t){if(null===e)t.element.style.display="none";else{var n=t.getPosRatio(),i={x:t.originalPosRatio.x+e.x,y:t.originalPosRatio.y+e.y};"none"===t.element.style.display&&(t.element.style.display="");var o="bezierQuad"===this.options.pathing?h.bezierQuad(n,t.originalPosRatio,i):h.linear(n,i);!function(e,t,n,i){var o=0,r=0,a=i(n),s=setInterval((function(){o>=n&&clearInterval(s);var i=t(r);e.style.left=c(i.x),e.style.top=c(i.y),r=a(o+=10)}),10)}(t.element,o,1e3,this.options.timing)}}},{key:"calculateAvoidanceFactor",value:function(e,t,n){void 0===n&&(n=this.options.factorMethod.name);return(void 0!==n?v[n]:v.powerInverse)(this.options.factorMethod.scale,this.options.factorMethod.offset,this.options.factorMethod.power)(e,t)}},{key:"calculateAvoidanceDisplacement",value:function(e,t,n){void 0===n&&(n=this.options.displacementMethod.name);return(void 0!==n?m[n]:m.threshold)(this.options.displacementMethod.thresholdRadius)(e,t)}}]),n}()}));
//# sourceMappingURL=avoidance.min.js.map
