{"version":3,"file":"draggamil.js","sources":["../src/draggamil.ts"],"sourcesContent":["const Draggamil = function(containerSelector: string, itemsSelector: string) {\r\n  const ATTR_DRAG_ID = \"data-draggamil-drag-id\" as const;\r\n\r\n  const dragItems = document.querySelectorAll(itemsSelector) as NodeListOf<HTMLElement>;\r\n  const container = document.querySelector(containerSelector);\r\n  const dragStates = {};\r\n  let dragMaxZ = 0;\r\n\r\n  dragItems.forEach(function (dragItem, idx) {\r\n    const idxKey = \"\" + idx;\r\n    dragItem.setAttribute(ATTR_DRAG_ID, idxKey);\r\n    const initialTransform = window.getComputedStyle(dragItem).getPropertyValue('transform');\r\n    dragStates[idxKey] = {\r\n      active: false,\r\n      currentX: undefined,\r\n      currentY: undefined,\r\n      initialX: undefined,\r\n      initialY: undefined,\r\n      initialTransform: initialTransform === \"none\" ? \"\" : initialTransform,\r\n      xOffset: 0,\r\n      yOffset: 0,\r\n    };\r\n    var initialZ = parseInt(window.getComputedStyle(dragItem).getPropertyValue('z-index')) ?? 0;\r\n    if (initialZ > dragMaxZ) {\r\n      dragMaxZ = initialZ;\r\n    }\r\n  });\r\n\r\n  container.addEventListener(\"touchstart\", dragStart, false);\r\n  container.addEventListener(\"touchend\", dragStop, false);\r\n  container.addEventListener(\"touchmove\", drag, false);\r\n\r\n  container.addEventListener(\"mousedown\", dragStart, false);\r\n  container.addEventListener(\"mouseup\", dragStop, false);\r\n  container.addEventListener(\"mouseleave\", dragStopIfLeavingContainer, false);\r\n  container.addEventListener(\"mousemove\", drag, false);\r\n\r\n  function dragStart(e?: MouseEvent | TouchEvent) {\r\n    // Check if event target exists\r\n    if (!e || !e.target) {\r\n      // Cannot start drag if no event target, so stop all dragging.\r\n      dragStop();\r\n      return;\r\n    }\r\n\r\n    const { dragItem, dragId } = getClosestDragItem(e.target as HTMLElement) ?? {};\r\n    if (!dragId) {\r\n      dragStop();\r\n      return;\r\n    }\r\n\r\n    var dragState = dragStates[dragId];\r\n    if (e.type === \"touchstart\") {\r\n      dragState.initialX = (e as TouchEvent).touches[0].clientX - dragState.xOffset;\r\n      dragState.initialY = (e as TouchEvent).touches[0].clientY - dragState.yOffset;\r\n    }\r\n    else {\r\n      dragState.initialX = (e as MouseEvent).clientX - dragState.xOffset;\r\n      dragState.initialY = (e as MouseEvent).clientY - dragState.yOffset;\r\n    }\r\n\r\n    ++dragMaxZ;\r\n    dragItem.style['z-index'] = dragMaxZ;\r\n    dragState.active = true;\r\n  }\r\n\r\n  function getClosestDragItem(el: HTMLElement): { dragItem: HTMLElement; dragId: string; } {\r\n    let dragId = el.getAttribute(ATTR_DRAG_ID);\r\n    if (dragId) {\r\n      return { dragItem: el, dragId };\r\n    }\r\n\r\n    const maybeAncestorEl = el.closest(itemsSelector);\r\n    dragId = maybeAncestorEl.getAttribute(ATTR_DRAG_ID);\r\n    if (dragId) {\r\n      return { dragItem: maybeAncestorEl as HTMLElement, dragId };\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  function dragStop() {\r\n    // Stop all active drag states\r\n    Object.keys(dragStates).forEach(function(dragId) {\r\n      var dragState = dragStates[dragId];\r\n      if (dragState.active) {\r\n        dragState.initialX = dragState.currentX;\r\n        dragState.initialY = dragState.currentY;\r\n  \r\n        dragState.active = false;\r\n      }\r\n    });\r\n    return;\r\n  }\r\n\r\n  function dragStopIfLeavingContainer(e?: MouseEvent | TouchEvent) {\r\n    if (container === e.target) {\r\n      dragStop();\r\n    }\r\n  }\r\n\r\n  function drag(e?: MouseEvent | TouchEvent) {\r\n    dragItems.forEach(function(dragItem) {\r\n      var dragId = dragItem.getAttribute(ATTR_DRAG_ID);\r\n      if (!dragId) {\r\n        return;\r\n      }\r\n\r\n      var dragState = dragStates[dragId];\r\n      if (dragState.active) {\r\n        e.preventDefault();\r\n        \r\n        if (e.type === \"touchmove\") {\r\n          dragState.currentX = (e as TouchEvent).touches[0].clientX - dragState.initialX;\r\n          dragState.currentY = (e as TouchEvent).touches[0].clientY - dragState.initialY;\r\n        } else {\r\n          dragState.currentX = (e as MouseEvent).clientX - dragState.initialX;\r\n          dragState.currentY = (e as MouseEvent).clientY - dragState.initialY;\r\n        }\r\n  \r\n        dragState.xOffset = dragState.currentX;\r\n        dragState.yOffset = dragState.currentY;\r\n  \r\n        dragItem.style.transform = \"translate3d(\" + dragState.currentX + \"px, \" + dragState.currentY + \"px, 0) \" + dragState.initialTransform;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport default Draggamil;\r\n"],"names":["Draggamil","containerSelector","itemsSelector","ATTR_DRAG_ID","dragItems","document","querySelectorAll","container","querySelector","dragStates","dragMaxZ","forEach","dragItem","idx","idxKey","setAttribute","initialTransform","window","getComputedStyle","getPropertyValue","active","currentX","undefined","currentY","initialX","initialY","xOffset","yOffset","initialZ","parseInt","addEventListener","dragStart","dragStop","drag","dragStopIfLeavingContainer","e","target","dragId","getClosestDragItem","dragState","type","touches","clientX","clientY","style","el","getAttribute","maybeAncestorEl","closest","Object","keys","preventDefault","transform"],"mappings":"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"}