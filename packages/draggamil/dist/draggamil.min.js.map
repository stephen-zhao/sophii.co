{"version":3,"file":"draggamil.min.js","sources":["../src/draggamil.ts"],"sourcesContent":["const Draggamil = function(containerSelector: string, itemsSelector: string) {\r\n  const ATTR_DRAG_ID = \"data-draggamil-drag-id\" as const;\r\n\r\n  const dragItems = document.querySelectorAll(itemsSelector) as NodeListOf<HTMLElement>;\r\n  const container = document.querySelector(containerSelector);\r\n  const dragStates = {};\r\n  let dragMaxZ = 0;\r\n\r\n  dragItems.forEach(function (dragItem, idx) {\r\n    const idxKey = \"\" + idx;\r\n    dragItem.setAttribute(ATTR_DRAG_ID, idxKey);\r\n    const initialTransform = window.getComputedStyle(dragItem).getPropertyValue('transform');\r\n    dragStates[idxKey] = {\r\n      active: false,\r\n      currentX: undefined,\r\n      currentY: undefined,\r\n      initialX: undefined,\r\n      initialY: undefined,\r\n      initialTransform: initialTransform === \"none\" ? \"\" : initialTransform,\r\n      xOffset: 0,\r\n      yOffset: 0,\r\n    };\r\n    var initialZ = parseInt(window.getComputedStyle(dragItem).getPropertyValue('z-index')) ?? 0;\r\n    if (initialZ > dragMaxZ) {\r\n      dragMaxZ = initialZ;\r\n    }\r\n  });\r\n\r\n  container.addEventListener(\"touchstart\", dragStart, false);\r\n  container.addEventListener(\"touchend\", dragStop, false);\r\n  container.addEventListener(\"touchmove\", drag, false);\r\n\r\n  container.addEventListener(\"mousedown\", dragStart, false);\r\n  container.addEventListener(\"mouseup\", dragStop, false);\r\n  container.addEventListener(\"mouseleave\", dragStopIfLeavingContainer, false);\r\n  container.addEventListener(\"mousemove\", drag, false);\r\n\r\n  function dragStart(e?: MouseEvent | TouchEvent) {\r\n    // Check if event target exists\r\n    if (!e || !e.target) {\r\n      // Cannot start drag if no event target, so stop all dragging.\r\n      dragStop();\r\n      return;\r\n    }\r\n\r\n    const { dragItem, dragId } = getClosestDragItem(e.target as HTMLElement) ?? {};\r\n    if (!dragId) {\r\n      dragStop();\r\n      return;\r\n    }\r\n\r\n    var dragState = dragStates[dragId];\r\n    if (e.type === \"touchstart\") {\r\n      dragState.initialX = (e as TouchEvent).touches[0].clientX - dragState.xOffset;\r\n      dragState.initialY = (e as TouchEvent).touches[0].clientY - dragState.yOffset;\r\n    }\r\n    else {\r\n      dragState.initialX = (e as MouseEvent).clientX - dragState.xOffset;\r\n      dragState.initialY = (e as MouseEvent).clientY - dragState.yOffset;\r\n    }\r\n\r\n    ++dragMaxZ;\r\n    dragItem.style['z-index'] = dragMaxZ;\r\n    dragState.active = true;\r\n  }\r\n\r\n  function getClosestDragItem(el: HTMLElement): { dragItem: HTMLElement; dragId: string; } {\r\n    let dragId = el.getAttribute(ATTR_DRAG_ID);\r\n    if (dragId) {\r\n      return { dragItem: el, dragId };\r\n    }\r\n\r\n    const maybeAncestorEl = el.closest(itemsSelector);\r\n    dragId = maybeAncestorEl.getAttribute(ATTR_DRAG_ID);\r\n    if (dragId) {\r\n      return { dragItem: maybeAncestorEl as HTMLElement, dragId };\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  function dragStop() {\r\n    // Stop all active drag states\r\n    Object.keys(dragStates).forEach(function(dragId) {\r\n      var dragState = dragStates[dragId];\r\n      if (dragState.active) {\r\n        dragState.initialX = dragState.currentX;\r\n        dragState.initialY = dragState.currentY;\r\n  \r\n        dragState.active = false;\r\n      }\r\n    });\r\n    return;\r\n  }\r\n\r\n  function dragStopIfLeavingContainer(e?: MouseEvent | TouchEvent) {\r\n    if (container === e.target) {\r\n      dragStop();\r\n    }\r\n  }\r\n\r\n  function drag(e?: MouseEvent | TouchEvent) {\r\n    dragItems.forEach(function(dragItem) {\r\n      var dragId = dragItem.getAttribute(ATTR_DRAG_ID);\r\n      if (!dragId) {\r\n        return;\r\n      }\r\n\r\n      var dragState = dragStates[dragId];\r\n      if (dragState.active) {\r\n        e.preventDefault();\r\n        \r\n        if (e.type === \"touchmove\") {\r\n          dragState.currentX = (e as TouchEvent).touches[0].clientX - dragState.initialX;\r\n          dragState.currentY = (e as TouchEvent).touches[0].clientY - dragState.initialY;\r\n        } else {\r\n          dragState.currentX = (e as MouseEvent).clientX - dragState.initialX;\r\n          dragState.currentY = (e as MouseEvent).clientY - dragState.initialY;\r\n        }\r\n  \r\n        dragState.xOffset = dragState.currentX;\r\n        dragState.yOffset = dragState.currentY;\r\n  \r\n        dragItem.style.transform = \"translate3d(\" + dragState.currentX + \"px, \" + dragState.currentY + \"px, 0) \" + dragState.initialTransform;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport default Draggamil;\r\n"],"names":["containerSelector","itemsSelector","ATTR_DRAG_ID","dragItems","document","querySelectorAll","container","querySelector","dragStates","dragMaxZ","dragStart","e","target","dragStop","dragItem","dragId","el","getAttribute","maybeAncestorEl","closest","getClosestDragItem","dragState","type","initialX","touches","clientX","xOffset","initialY","clientY","yOffset","style","active","Object","keys","forEach","currentX","currentY","drag","preventDefault","transform","initialTransform","idx","idxKey","setAttribute","window","getComputedStyle","getPropertyValue","undefined","initialZ","parseInt","addEventListener"],"mappings":"iPAAkB,SAASA,EAA2BC,SAC9CC,EAAe,yBAEfC,EAAYC,SAASC,iBAAiBJ,GACtCK,EAAYF,SAASG,cAAcP,GACnCQ,EAAa,OACfC,EAAW,WA+BNC,EAAUC,OAEZA,IAAMA,EAAEC,mBAEXC,UAIIC,SAAEA,EAAFC,OAAYA,YAqBQC,OACtBD,EAASC,EAAGC,aAAaf,MACzBa,QACK,CAAED,SAAUE,EAAID,OAAAA,SAGnBG,EAAkBF,EAAGG,QAAQlB,MACnCc,EAASG,EAAgBD,aAAaf,GAClCa,QACK,CAAED,SAAUI,EAAgCH,OAAAA,UA9BxBK,CAAmBT,EAAEC,SAA0B,MACvEG,OAKDM,EAAYb,EAAWO,GACZ,eAAXJ,EAAEW,MACJD,EAAUE,SAAYZ,EAAiBa,QAAQ,GAAGC,QAAUJ,EAAUK,QACtEL,EAAUM,SAAYhB,EAAiBa,QAAQ,GAAGI,QAAUP,EAAUQ,UAGtER,EAAUE,SAAYZ,EAAiBc,QAAUJ,EAAUK,QAC3DL,EAAUM,SAAYhB,EAAiBiB,QAAUP,EAAUQ,WAG3DpB,EACFK,EAASgB,MAAM,WAAarB,EAC5BY,EAAUU,QAAS,OAhBjBlB,aAkCKA,IAEPmB,OAAOC,KAAKzB,GAAY0B,SAAQ,SAASnB,OACnCM,EAAYb,EAAWO,GACvBM,EAAUU,SACZV,EAAUE,SAAWF,EAAUc,SAC/Bd,EAAUM,SAAWN,EAAUe,SAE/Bf,EAAUU,QAAS,eAYhBM,EAAK1B,GACZR,EAAU+B,SAAQ,SAASpB,OACrBC,EAASD,EAASG,aAAaf,MAC9Ba,OAIDM,EAAYb,EAAWO,GACvBM,EAAUU,SACZpB,EAAE2B,iBAEa,cAAX3B,EAAEW,MACJD,EAAUc,SAAYxB,EAAiBa,QAAQ,GAAGC,QAAUJ,EAAUE,SACtEF,EAAUe,SAAYzB,EAAiBa,QAAQ,GAAGI,QAAUP,EAAUM,WAEtEN,EAAUc,SAAYxB,EAAiBc,QAAUJ,EAAUE,SAC3DF,EAAUe,SAAYzB,EAAiBiB,QAAUP,EAAUM,UAG7DN,EAAUK,QAAUL,EAAUc,SAC9Bd,EAAUQ,QAAUR,EAAUe,SAE9BtB,EAASgB,MAAMS,UAAY,eAAiBlB,EAAUc,SAAW,OAASd,EAAUe,SAAW,UAAYf,EAAUmB,sBAnH3HrC,EAAU+B,SAAQ,SAAUpB,EAAU2B,SAC9BC,EAAS,GAAKD,EACpB3B,EAAS6B,aAAazC,EAAcwC,SAC9BF,EAAmBI,OAAOC,iBAAiB/B,GAAUgC,iBAAiB,aAC5EtC,EAAWkC,GAAU,CACnBX,QAAQ,EACRI,cAAUY,EACVX,cAAUW,EACVxB,cAAUwB,EACVpB,cAAUoB,EACVP,iBAAuC,SAArBA,EAA8B,GAAKA,EACrDd,QAAS,EACTG,QAAS,OAEPmB,EAAWC,SAASL,OAAOC,iBAAiB/B,GAAUgC,iBAAiB,aAAe,EACtFE,EAAWvC,IACbA,EAAWuC,MAIf1C,EAAU4C,iBAAiB,aAAcxC,GAAW,GACpDJ,EAAU4C,iBAAiB,WAAYrC,GAAU,GACjDP,EAAU4C,iBAAiB,YAAab,GAAM,GAE9C/B,EAAU4C,iBAAiB,YAAaxC,GAAW,GACnDJ,EAAU4C,iBAAiB,UAAWrC,GAAU,GAChDP,EAAU4C,iBAAiB,uBA6DSvC,GAC9BL,IAAcK,EAAEC,QAClBC,OA/DiE,GACrEP,EAAU4C,iBAAiB,YAAab,GAAM"}